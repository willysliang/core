---
Author: willysliang
CreateTime: 2023-03-31 16:56:31
Modifier: willysliang
ModifiedTime: 2023-03-31 16:57:29
Description: ES6+è¯­æ³•â…¡
---

## ES6+è¯­æ³•â…¡

## æ¨¡å—åŒ–

> ```bash
> ## æ¨¡å—è§„èŒƒåŒ–	
> ç¼–ç¨‹è¯­è¨€ä¸­çš„æ¨¡å—é€šå¸¸æ˜¯ä¸ºäº†é¿å…å…¨å±€æ±¡æŸ“ï¼ŒåŒæ—¶æ›´å¥½åœ°ç»„ç»‡ç¨‹åºé€»è¾‘ï¼Œæ–¹ä¾¿ä»£ç å¤ç”¨ã€‚
> 		- æ¨¡å—å®šä¹‰ï¼šå¦‚æœå®šä¹‰ç§æœ‰å’Œå…¬å¼€å˜é‡ã€å±æ€§ã€å‡½æ•°ã€æ–¹æ³•
> 		- æ¨¡å—åŠ è½½ï¼šå¦‚ä½•åœ¨è¿è¡Œç¯å¢ƒä¸­ä½¿ç”¨æ¨¡å—ï¼Œæ¨¡å—ä¹‹é—´å¦‚ä½•ç›¸äº’å¼•ç”¨
> æ¨¡å—çš„åŠ è½½åœ¨ nodejs å’Œæµè§ˆå™¨çš„åŒºåˆ«ï¼š
> 		- Nodejs æ¨¡å—æ–‡ä»¶çš„åç¼€åä¸º .mjs
> 		- æµè§ˆå™¨ä¸º script æ ‡ç­¾
> 
> 
> ## æ¨¡å—åŒ–
> 1. ç¬¬ä¸€é˜¶æ®µï¼šä»…ä»…åŸºäºæ–‡ä»¶çš„åˆ’åˆ†æ¨¡å—çš„æ–¹å¼
> å…·ä½“åšæ³•å°±æ˜¯å°†æ¯ä¸ªåŠŸèƒ½åŠå…¶ç›¸å…³çŠ¶æ€æ•°æ®å„è‡ªå•ç‹¬æ”¾åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œçº¦å®šæ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼Œä½¿ç”¨æŸä¸ªæ¨¡å—å°±æ˜¯å°†è¿™ä¸ªæ¨¡å—å¼•å…¥åˆ°é¡µé¢ä¸­ï¼Œç„¶åç›´æ¥è°ƒç”¨æ¨¡å—ä¸­çš„æˆå‘˜ï¼ˆå˜é‡ / å‡½æ•°ï¼‰
> ç¼ºç‚¹ï¼šæ‰€æœ‰æ¨¡å—éƒ½ç›´æ¥åœ¨å…¨å±€å·¥ä½œï¼Œæ²¡æœ‰ç§æœ‰ç©ºé—´ï¼Œæ‰€æœ‰æˆå‘˜éƒ½å¯ä»¥åœ¨æ¨¡å—å¤–éƒ¨è¢«è®¿é—®æˆ–è€…ä¿®æ”¹ï¼Œè€Œä¸”æ¨¡å—è¿‡å¤šï¼Œå®¹æ˜“äº§ç”Ÿå‘½åå†²çªï¼Œå¦å¤–æ— æ³•ç®¡ç†æ¨¡å—ä¸æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»
> 
> 
> 2. ç¬¬äºŒé˜¶æ®µï¼šã€å‘½åç©ºé—´ã€‘æ¯ä¸ªæ¨¡å—æš´éœ²ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œæ‰€æœ‰æ¨¡å—æˆå‘˜éƒ½æŒ‚è½½åˆ°è¿™ä¸ªå¯¹è±¡ä¸­
> å…·ä½“åšæ³•å°±æ˜¯åœ¨ç¬¬ä¸€é˜¶æ®µçš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å°†æ¯ä¸ªæ¨¡å—ã€ŒåŒ…è£¹ã€ä¸ºä¸€ä¸ªå…¨å±€å¯¹è±¡çš„å½¢å¼å®ç°ï¼Œæœ‰ç‚¹ç±»ä¼¼äºä¸ºæ¨¡å—å†…çš„æˆå‘˜æ·»åŠ äº†ã€Œå‘½åç©ºé—´ã€ã€‚
> é€šè¿‡ã€Œå‘½åç©ºé—´ã€å‡å°äº†å‘½åå†²çªçš„å¯èƒ½ï¼Œä½†æ˜¯åŒæ ·æ²¡æœ‰ç§æœ‰ç©ºé—´ï¼Œæ‰€æœ‰æ¨¡å—æˆå‘˜ä¹Ÿå¯ä»¥åœ¨æ¨¡å—å¤–éƒ¨è¢«è®¿é—®æˆ–è€…ä¿®æ”¹ï¼Œè€Œä¸”ä¹Ÿæ— æ³•ç®¡ç†æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚
> åœ¨ JS ä¸­ï¼Œä¸ºäº†ä¸æ±¡æŸ“å…¨å±€å˜é‡ï¼Œæˆ‘ä»¬æŠŠæƒ³è¦è®¿é—®çš„å˜é‡ç”¨ä¸€ä¸ªã€Œå‘½åç©ºé—´ã€åŒ…è£¹ã€‚å®é™…ä¸Šå°±æ˜¯æ–°å»ºäº†ä¸€ä¸ªåŒ…å«å±æ€§çš„å¯¹è±¡ï¼Œé¿å…å±æ€§ç›´æ¥æŒ‚è½½åœ¨å…¨å±€å˜é‡ï¼ˆwindow/Globalï¼‰ä¸Šã€‚ä½†è¿™ä¸ªå¯¹è±¡å¯ä»»æ„ä¿®æ”¹ï¼Œæ²¡æœ‰å°é—­çš„ä½œç”¨åŸŸï¼Œæ‰€ä»¥å¹¶éçœŸæ­£çš„æ¨¡å—ã€‚
>       var moduleA = { id: 1, name: 'test' }
>       console.log(moduleA.id)
> 
> 
> 3. ç¬¬ä¸‰é˜¶æ®µï¼šä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼ï¼ˆIIFEï¼šImmediately-Invoked Function Expressionï¼‰ä¸ºæ¨¡å—æä¾›ç§æœ‰ç©ºé—´
> å…·ä½“åšæ³•å°±æ˜¯å°†æ¯ä¸ªæ¨¡å—æˆå‘˜éƒ½æ”¾åœ¨ä¸€ä¸ªå‡½æ•°æä¾›çš„ç§æœ‰ä½œç”¨åŸŸä¸­ï¼Œå¯¹äºéœ€è¦æš´éœ²ç»™å¤–éƒ¨çš„æˆå‘˜ï¼Œé€šè¿‡æŒ‚åœ¨åˆ°å…¨å±€å¯¹è±¡ä¸Šçš„æ–¹å¼å®ç°
> æœ‰äº†ç§æœ‰æˆå‘˜çš„æ¦‚å¿µï¼Œç§æœ‰æˆå‘˜åªèƒ½åœ¨æ¨¡å—æˆå‘˜å†…é€šè¿‡é—­åŒ…çš„å½¢å¼è®¿é—®ã€‚
> åˆ©ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼åˆ›å»ºä¸€ä¸ªé—­åŒ…ï¼šå‡½æ•°å†…éƒ¨çš„å˜é‡å‡ä¸ºç§æœ‰ï¼Œå¯¹å¤–æš´éœ²å‡½æ•°çš„è¿”å›å€¼ï¼Œè¿™ä¸ªé—­åŒ…å°±æˆä¸ºä¸€ä¸ªæ¨¡å—ã€‚
>       var moduleA = (function  () {
>         var _id = 1
>         var _getId = function () { console.log(id) }
>         // å¯¹å¤–æš´éœ²çš„æ˜¯è¿”å›å€¼
>         return { getId: _getId }
>       })()
>       moduleA._id // undefined
>       moduleA._getId // undefined
>       module.getId // 1
> 
> 
> 4. ç¬¬å››é˜¶æ®µï¼š åˆ©ç”¨ IIFE å‚æ•°ä½œä¸ºä¾èµ–å£°æ˜ä½¿ç”¨
> å…·ä½“åšæ³•å°±æ˜¯åœ¨ç¬¬ä¸‰é˜¶æ®µçš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°çš„å‚æ•°ä¼ é€’æ¨¡å—ä¾èµ–é¡¹ã€‚
> è¿™ä½¿å¾—æ¯ä¸€ä¸ªæ¨¡å—ä¹‹é—´çš„å…³ç³»å˜å¾—æ›´åŠ æ˜æ˜¾ã€‚
> 
> 
> 5. ç¬¬äº”é˜¶æ®µï¼š æ¨¡å—åŒ–è§„èŒƒ
> Require.js æä¾›äº† AMD æ¨¡å—åŒ–è§„èŒƒï¼Œä»¥åŠä¸€ä¸ªè‡ªåŠ¨åŒ–æ¨¡å—åŠ è½½å™¨---æ¨¡å—åŒ–è§„èŒƒçš„å‡ºç°ã€‚
> å†ä¹‹åä¾¿æœ‰äº†å…¶ä»–æ›´å¤šæ ‡å‡†ç´§æ¥è€Œæ¥ï¼ŒCommonJSã€CMDã€‚
> ```

### CommonJSï¼ˆnodejsï¼‰

> ```bash
> ## CommonJS è§„èŒƒï¼ˆnodejs æå‡ºçš„æ ‡å‡†ï¼‰
> CommonJS ä¸­ä¸€ä¸ª JS æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰å•ç‹¬çš„ä½œç”¨åŸŸ(æ–‡ä»¶ä¸­çš„æ‰€æœ‰å˜é‡å‡ä¸ºç§æœ‰å˜é‡)ï¼›
> 	é€šè¿‡ `module.exports` å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢åŒ…å«çš„åˆ™æ˜¯å…¬å¼€å˜é‡ï¼›
> 	å¼•ç”¨æ—¶é€šè¿‡ `require` å‡½æ•°è½½å…¥æ¨¡å—ï¼Œå…¶è·å–æ¨¡å—å¯¼å‡ºçš„å¯¹è±¡ã€‚
> 
> ç¼ºç‚¹ï¼šCommonJS æ˜¯ä»¥åŒæ­¥æ¨¡å¼åŠ è½½æ¨¡å—ï¼Œå³ç­‰å¾…æ‰€æœ‰æ¨¡å—åŠ è½½å®Œæ¯•åå†æ‰§è¡Œä»£ç ã€‚
> 	- nodejs æ‰§è¡Œæœºåˆ¶æ˜¯å¯åŠ¨æ—¶åŠ è½½æ¨¡å—ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­ä¸éœ€è¦åŠ è½½ï¼Œåªéœ€è¦ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°é—®é¢˜ã€‚
> 	- åœ¨äº”ç¦æ®µæ— éœ€è¦è€ƒè™‘ç½‘ç»œçš„åœºæ™¯ä¸‹ä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ã€‚
> 	- ä½†åœ¨æµè§ˆå™¨ï¼ŒåŒæ­¥åŠ è½½çš„æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´è¾ƒé•¿çš„ç½‘ç»œåŠ è½½æ—¶é—´ï¼›æˆ–ä¼šå¯¼è‡´å¤§é‡åŒæ­¥è¯·æ±‚å‡ºç°ï¼Œå› è€Œå¯¼è‡´æ•ˆç‡ä½ã€‚
> ```
>
> ```js
> // ModuleA.js
> var id = 1
> var getId = function () {
>   console.log(id)
> }
> module.exports = { getId }
> 
> 
> // ModuleB.js
> const moduleA = require('ModuleA.js')
> moduleA.id	// undefined
> moduleA.getId()	// 1
> ```

### AMDï¼ˆå¼‚æ­¥ï¼šä¾èµ–å‰ç½®ï¼Œæå‰æ‰§è¡Œï¼‰

> ```bash
> ## AMDï¼ˆAsynchronous Module Definitionï¼‰å¼‚æ­¥æ¨¡å—å®šä¹‰è§„èŒƒ
> AMD æ˜¯ require.js æ¨å‡ºçš„æ¨¡å—è§„èŒƒã€‚é€šè¿‡ define APIå‡½æ•°å®šä¹‰å’Œå¼•ç”¨æ¨¡å—ã€‚
> ä¼˜åŠ¿ï¼šç›®å‰ç»å¤§å¤šæ•°ç¬¬ä¸‰æ–¹åº“éƒ½æ”¯æŒ AMD è§„èŒƒã€‚
> ç¼ºç‚¹ï¼šä½¿ç”¨å¤æ‚æ¨¡å—åˆ’åˆ†ç»†è‡´ï¼Œæ¨¡å— JS æ–‡ä»¶ä¼šå‡ºç°è¯·æ±‚é¢‘ç¹çš„æƒ…å†µã€‚
> 
> 
> ## Require.js
> æä¾› AMD æ¨¡å—åŒ–è§„èŒƒï¼Œä»¥åŠä¸€ä¸ªè‡ªåŠ¨åŒ–æ¨¡å—åŠ è½½å™¨ï¼Œæä¾› require å‡½æ•°åŠ è½½æ¨¡å—ã€‚
> ```
>
> ```js
> // å…¥å£æ–‡ä»¶å¼•å…¥ sea.js
> <script src="sea.js"></script>
> <script>
> seajs.config({
>  base: "js",
>  alias: { jquery: "jquery/jquery/1.10.1/jquery.js" },
> });
> seajs.use("js/main.js");
> </script> 
> 
> 
> // moduleA.js
> define(function () {
> // ç§æœ‰å˜é‡
> var id = 1
> var getId = function () { console.log(id) }
> // æš´éœ²æ¨¡å—
> return { getId }
> })
> 
> 
> // moduleB.js
> define(/** ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¨¡å—å¼•ç”¨åˆ—è¡¨ */['moduleA'], function () {
> console.log(moduleA.getId())
> })
> ```

### CMDï¼ˆå¼‚æ­¥ï¼šä¾èµ–å°±è¿‘ï¼Œå»¶è¿Ÿæ‰§è¡Œï¼‰

> ```bash
> ## Sea.js(æ·˜å®æ¨å‡º) + CMD(é€šç”¨æ¨¡å—å®šä¹‰è§„èŒƒ)
> CMDæ˜¯ sea.js æ¨å¹¿çš„å¦ä¸€ä¸ªå¼‚æ­¥åŠ è½½æ¨¡å—è§„èŒƒï¼ŒåæœŸä¹Ÿè¢« Require.js å…¼å®¹ã€‚
> ä½¿ç”¨æ–¹å¼å’Œ AMD ç±»ä¼¼ï¼Œéƒ½æ˜¯åœ¨å…¥å£ html æ–‡ä»¶ä¸­å¼•å…¥æ¨¡å—ä¾èµ–åŒ…å¹¶è¿›è¡Œé…ç½®ï¼Œç„¶ååœ¨ js æ–‡ä»¶ä¸­æ ¹æ®å„è‡ªè§„èŒƒçš„ API å®šä¹‰å’Œå¼•ç”¨æ¨¡å—ã€‚
> ```
>
> ```js
> // å…¥å£æ–‡ä»¶å¼•å…¥ sea.js
> <script src="sea.js"></script>
> <script>
> seajs.config({
>  base: "js",
>  alias: { jquery: "jquery/jquery/1.10.1/jquery.js" },
> })
> seajs.use("js/main.js")
> </script> 
> 
> 
> // moduleA.js
> define(function (require, exports, module) {
> // ç§æœ‰å˜é‡
> var id = 1
> var getId = function () { console.log(id) }
> // æš´éœ²æ¨¡å—
> module.exports = { getId }
> })
> 
> 
> // moduleB.js
> define(function (require, exports, module) {
> const moduleA = require("moduleA")
> console.log(moduleA.getId())
> })
> ```

### UMDï¼ˆæ¨¡å—å…¼å®¹æ–¹æ¡ˆï¼‰

> ```bash
> ### AMD & CMD çš„åŒºåˆ«
> AMD å’Œ CMD çš„åŒºåˆ«åœ¨äºä¾èµ–å¼•å…¥çš„æ—¶æœºã€‚
> 	1. AMD ä¼šå°†å…¨éƒ¨ä¾èµ–å‰ç½®ï¼Œåªè¦åŠ è½½å®Œæˆå°±ä¼šæ‰§è¡Œä»£ç ï¼›
> 	2. CMD åˆ™æ¨èå°†ä¾èµ–å°±è¿›å¤„ç†ï¼Œéœ€è¦æ—¶å†å¼•å…¥ã€‚
> 
> è¿™ä¸¤ç§æ–¹å¼æ²¡æœ‰ä¼˜åŠ£ä¹‹åˆ†ï¼Œå¯èƒ½ä»èŠ‚çœç½‘ç»œå¼€é”€çš„è§’åº¦ä¸Š CMD ä¼šæ›´å¥½äº›ï¼›åœ¨ AMD çš„æ–¹æ¡ˆä¸­ï¼Œè‹¥ b.doSomething() æ˜¯åœ¨æŸä¸ªæ¡ä»¶ä¸‹æ‰§è¡Œï¼Œä½†æ²¡æœ‰è¢«æ‰§è¡Œåˆ°ï¼Œé‚£ä¹ˆæ¨¡å— b çš„åŠ è½½æ˜¯æµªè´¹çš„ï¼ˆä½†ä¸å½±å“ç¨‹åºæ‰§è¡Œé€Ÿåº¦ï¼‰ã€‚
> 
> 
> ## UMDï¼ˆæ¨¡å—å…¼å®¹æ–¹æ¡ˆï¼‰
> UMD ä¸æ˜¯ä¸€ä¸ªæ¨¡å—è§„èŒƒï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹ AMD å’Œ CommonJS çš„å…¼å®¹æ–¹æ¡ˆï¼Œç›®çš„æ˜¯ä¸ºäº†è®©æ¨¡å—åŒæ—¶èƒ½å¤Ÿæ”¯æŒæµè§ˆå™¨å’Œ Nodejs ä¸¤ä¸ªè¿è¡Œã€‚
> ```
>
> #### AMD & CMD
>
> ```js
> // AMD æ¨è
> define(["a", "b"], function (a, b) {
>   a.doSomething(); // ä¾èµ–å‰ç½®ï¼Œæå‰æ‰§è¡Œ
>   b.doSomething();
> });
> 
> 
> // CMD æ¨è
> define(function (require, exports, module) {
> var a = require("a");
>   a.doSomething();
> var b = require("b");
>   b.doSomething(); // ä¾èµ–å°±è¿‘ï¼Œå»¶è¿Ÿæ‰§è¡Œ
> }); 
> ```
>
> #### UMDæ–¹æ¡ˆ
>
> ```js
> (function (window, factory) {
>   // Node.js ç¯å¢ƒ
>   if (typeof exports === "object") {
>     module.exports = factory();
>     // æµè§ˆå™¨ç¯å¢ƒï¼Œæ”¯æŒ AMD
>   } else if (typeof define === "function" && define.amd) {
>     define(factory);
>     // æµè§ˆå™¨ç¯å¢ƒï¼Œä¸æ”¯æŒ AMD
>   } else {
>     window.eventUtil = factory();
>   }
> })(this, function () {
>   //module ...
> }); 
> ```

### ES Modulesï¼ˆæµè§ˆå™¨ï¼‰

> ```bash
> ## ES Modules
> ES6 Module æ˜¯ JavaScript ä¸­å®˜æ–¹æ”¯æŒçš„æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œå®ƒé‡‡ç”¨ import å’Œ export å…³é”®å­—å¯¼å…¥å’Œå¯¼å‡ºæ¨¡å—ã€‚
> ES6 æ¨¡å—åŒ–æ”¯æŒé™æ€åˆ†æï¼Œåœ¨ç¼–è¯‘æ—¶å°±èƒ½å¤Ÿç¡®å®šæ¨¡å—çš„ä¾èµ–å…³ç³»ï¼Œå› æ­¤å¯ä»¥è¿›è¡Œæ›´åŠ é«˜æ•ˆçš„æ‰“åŒ…å’Œå‹ç¼©ã€‚
> 
> 
> ### ES6 Module çš„ä½¿ç”¨
> é€šè¿‡ script æ·»åŠ  `type=module` çš„å±æ€§ä½¿ç”¨ ES Modulesã€‚
>     1. ESM è‡ªåŠ¨é‡‡ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œå¿½ç•¥ 'use strict'ã€‚
>     2. æ¯ä¸ª ES Module éƒ½æ˜¯è¿è¡Œåœ¨å•ç‹¬çš„ç§æœ‰ä½œç”¨åŸŸä¸­ã€‚
>     3. ESM æ˜¯é€šè¿‡ CORS çš„æ–¹å¼è¯·æ±‚å¤–éƒ¨ JS æ¨¡å—çš„ã€‚
>     4. ESM çš„ script æ ‡ç­¾ä¼šå»¶è¿Ÿæ‰§è¡Œè„šæœ¬ã€‚
> 
> 
> ### CommonJS ä¸ ES Modules çš„åŒºåˆ«
> 1. ä½¿ç”¨è¯­æ³•å±‚é¢ï¼ŒCommonJsæ˜¯é€šè¿‡module.exportsï¼Œexportså¯¼å‡ºï¼Œrequireå¯¼å…¥ï¼›ESModuleåˆ™æ˜¯exportå¯¼å‡ºï¼Œimportå¯¼å…¥
> 2. CommonJsæ˜¯è¿è¡Œæ—¶åŠ è½½æ¨¡å—ï¼ŒESModuleæ˜¯åœ¨é™æ€ç¼–è¯‘æœŸé—´å°±ç¡®å®šæ¨¡å—çš„ä¾èµ–
> 3. ESModuleåœ¨ç¼–è¯‘æœŸé—´ä¼šå°†æ‰€æœ‰importæå‡åˆ°é¡¶éƒ¨ï¼ŒCommonJsä¸ä¼šæå‡require
> 4. CommonJså¯¼å‡ºçš„æ˜¯ä¸€ä¸ªå€¼æ‹·è´ï¼Œä¼šå¯¹åŠ è½½ç»“æœè¿›è¡Œç¼“å­˜ï¼Œä¸€æ—¦å†…éƒ¨å†ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œåˆ™ä¸ä¼šåŒæ­¥åˆ°å¤–éƒ¨ã€‚ESModuleæ˜¯å¯¼å‡ºçš„ä¸€ä¸ªå¼•ç”¨ï¼Œå†…éƒ¨ä¿®æ”¹å¯ä»¥åŒæ­¥åˆ°å¤–éƒ¨
> 5. CommonJsä¸­é¡¶å±‚çš„thisæŒ‡å‘è¿™ä¸ªæ¨¡å—æœ¬èº«ï¼Œè€ŒESModuleä¸­é¡¶å±‚thisæŒ‡å‘undefined
> 6. CommonJSåŠ è½½çš„æ˜¯æ•´ä¸ªæ¨¡å—ï¼Œå°†æ‰€æœ‰çš„æ¥å£å…¨éƒ¨åŠ è½½è¿›æ¥ï¼ŒESModuleå¯ä»¥å•ç‹¬åŠ è½½å…¶ä¸­çš„æŸä¸ªæ¥å£
> 
> 
> ### å¯¼å‡ºå­—é¢é‡å’Œå¯¼å‡ºæ¨¡å—çš„åŒºåˆ«
>     å¯¼å‡ºå­—é¢é‡(å¦‚:å¯¹è±¡):export default { name, age }
>     æ³¨æ„: import {name, age} from 'modulename'å¯¼å…¥æ¨¡å—æ— æ³•ä½¿ç”¨åˆ°nameå’Œageçš„å€¼
> 
>     å¯¼å‡ºæ¨¡å—:
>       export { name, age }
>       import {name, age} from 'modulename' å¯¼å…¥æ¨¡å—å¯ä»¥ä½¿ç”¨åˆ°nameå’Œageçš„å€¼
> 		åŸå› ï¼šimportå¯¼å…¥çš„æ˜¯å¯¹æ¨¡å—å†…éƒ¨çš„ä½¿ç”¨
> 
> 		æ³¨æ„ï¼šexportæš´éœ²çš„æ˜¯æ¨¡å—çš„å¼•ç”¨å…³ç³»(åœ°å€)ï¼Œå¹¶ä¸”åªè¯»ä¸å¯ä¿®æ”¹(å°è¯•ä¿®æ”¹ä¼šæŠ¥é”™è¯¯)
> 
> 
> ### å¯¼å‡º
> 1. CommonJS ä¸­æ˜¯å…ˆå°†æ¨¡å—æ•´ä½“å¯¼å…¥ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åä»å¯¹è±¡ä¸­ç»“æ„å‡ºéœ€è¦çš„æˆå‘˜ 
> 			const { name, age } = require('./module.js')
> 2. ES Module ä¸­ { } æ˜¯å›ºå®šè¯­æ³•ï¼Œå°±æ˜¯ç›´æ¥æå–æ¨¡å—å¯¼å‡ºæˆå‘˜ 
> 			import { name, age } from './module.js'
> 3. ES Modules å¯¼å…¥æˆå‘˜å¹¶ä¸æ˜¯å¤åˆ¶ä¸€ä¸ªå‰¯æœ¬ï¼Œè€Œæ˜¯ç›´æ¥å¯¼å…¥æ¨¡å—æˆå‘˜çš„å¼•ç”¨åœ°å€ã€‚
> 		å³ import å¾—åˆ°çš„å˜é‡ä¸ export å¯¼å…¥çš„å˜é‡åœ¨å†…å­˜ä¸­æ˜¯åŒä¸€å—ç©ºé—´ã€‚ä¸€æ—¦æ¨¡å—ä¸­æˆå‘˜ä¿®æ”¹äº†ï¼Œè¿™é‡Œä¹Ÿä¼šåŒæ—¶ä¿®æ”¹ã€‚
> 4. å¯¼å…¥æ¨¡å—æˆå‘˜å˜é‡æ˜¯åªè¯»çš„ 
> 			name = 'tom' // æŠ¥é”™
> 5. å¯¼å…¥çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡çš„å±æ€§è¯»å†™ä¸å—å½±å“ 
> 			name.xxx = 'xxx' // æ­£å¸¸
> ```
>
> ```js
> // ModuleA.js
> var id = 1;
> // å¯ä»¥ç›´æ¥å¯¼å‡ºå˜é‡
> export const getId = function () {
>   console.log(id);
> };
> // ä¹Ÿå¯ä»¥æ•´ä½“å¯¼å‡ºæ¨¡å—
> export default { getId };
> 
> 
> // ModuleB.js
> import moduleA from 'moduleA.js'
> moduleA.id; // undefined
> moduleA.getId(); // 1 
> ```

#### ES Modules in Node.js - ä¸ CommonJS çš„å·®å¼‚

> ```bash
> ## ES Modules in Node.js - ä¸ CommonJS çš„å·®å¼‚
> 1ã€ESM ä¸­æ— æ³•å¼•ç”¨ CommonJS ä¸­çš„é‚£äº›æ¨¡å—å…¨å±€æˆå‘˜
> 2ã€require, module, exports å¯é€šè¿‡ import å’Œ export ä»£æ›¿
> 3ã€__filename å’Œ __dirname é€šè¿‡ import å¯¹è±¡çš„ meta å±æ€§è·å–
> ```
>
> ```js
> /** CommonJS */
> console.log(require) // åŠ è½½æ¨¡å—å‡½æ•°
> console.log(module) // æ¨¡å—å¯¹è±¡
> console.log(exports) // å¯¼å‡ºå¯¹è±¡åˆ«å
> console.log(__filename) // å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„
> console.log(__dirname) // å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•
> 
> 
> /** ES Modules */
> // é€šè¿‡ url æ¨¡å—çš„ fileURLToPath æ–¹æ³•è½¬æ¢ä¸ºè·¯å¾„
> import { fileURLToPath } from 'url'
> import { dirname } from 'path'
> const __filename = fileURLToPath(import.meta.url)
> const __dirname = dirname(__filename)
> console.log(__filename)
> console.log(__dirname)
> const currentUrl = import.meta.url
> console.log(currentUrl)
> ```

#### ES Moduleå·¥ä½œåŸç†

> ```bash
> ## ES Module çš„å·¥ä½œåŸç†
> æµè§ˆå™¨é€šè¿‡Module Recordçš„æ•°æ®ç»“æ„ã€‚æ¯ä¸ª Module Record åŒ…å«ï¼š
>     - ECMAScript Code: AST è¯­æ³•æ ‘
>     - éœ€è¦è¯·æ±‚çš„æ¨¡å—
>         - moduleA.js
>         - moduleB.js
>     - è¯·æ±‚æ¨¡å—çš„å…¥å£
>         - import CustomModule from 'moduleA.js': CustomModule å°±æ˜¯æ¨¡å—å…¥å£
>     - å…¶å®ƒå±æ€§å’Œæ–¹æ³•
> 
> 
> Module Record å†è½¬æ¢æˆä¸ºåŒ…å« code å’Œ state çš„ Module Instanceã€‚è½¬æ¢çš„è¿‡ç¨‹åˆ†ä¸‰æ­¥ï¼š
>     1. æ„é€ ï¼ˆConstructionï¼‰
>     2. å®ä¾‹åŒ–ï¼ˆInstantiationï¼‰
>     3. æ±‚å€¼ï¼ˆEvaluationï¼‰
> 
> ES modules: A cartoon deep-dive æ„é€ æ¯ä¸ª Module åœ¨æ„é€ é˜¶æ®µè¦æ‰§è¡Œä¸‰ä¸ªæ“ä½œï¼š
>     1. æ‰¾åˆ°åŒ…å«æ¨¡å—çš„æ–‡ä»¶
>     2. ä¸‹è½½æ–‡ä»¶
>     3. å°†æ–‡ä»¶è§£æä¸º Module Record
> 
> 
> ä¸Šè¿°è¿™ä¸¤ä¸ªæ­¥éª¤å’Œè¿è¡Œæ—¶ç›¸å…³ï¼Œä¾‹å¦‚æµè§ˆå™¨ä¸­æ–‡ä»¶é€šè¿‡ script æ ‡ç­¾å¼•å…¥çš„ï¼›è€Œ Node.js ä¸­æ–‡ä»¶ä»æ–‡ä»¶ç³»ç»Ÿä¸­å¼•å…¥ã€‚
> 
> æµè§ˆå™¨ä¼šå»ºç«‹ä¸€ä¸ª Module Mapï¼Œå½“è¯·æ±‚ä¸€ä¸ª URL æ—¶ï¼Œæµè§ˆå™¨æŠŠè¿™ä¸ª URL æ”¾å…¥ Module Mapï¼Œå¹¶å°†å…¶æ‰“ä¸Šæ ‡è®°æ¥æ ‡è¯†æ­£åœ¨ä¸‹è½½è¯¥æ–‡ä»¶ã€‚ä¹‹åå°±å‘é€è¯·æ±‚è·å–è¯¥æ–‡ä»¶ï¼Œç„¶åç»§ç»­è·å–ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼›åŒæ—¶ Module Map ä¹Ÿå……å½“èµ·æ¨¡å—ç¼“å­˜çš„ä½œç”¨ï¼Œå½“è¯·æ±‚çš„ URL å·²å­˜åœ¨æ—¶ï¼Œä¼šç›´æ¥ä» Map ä¸­å–å¾—æ¨¡å—ã€‚
> 
> å½“æ–‡ä»¶ä¸‹è½½å®Œæˆåï¼Œæµè§ˆå™¨ä¼šå°†æ–‡ä»¶è½¬æ¢ä¸º Module Recordï¼Œç„¶åä¿å­˜åœ¨ Module Map ä¸­ã€‚å®ä¾‹åŒ–æ˜¯ç»™å„ä¸ª Module Record ä¸­ export çš„å˜é‡å’Œå‡½æ•°åˆ†é…å†…å­˜åœ°å€ï¼Œæ¥ç€å°†å…¶å®ƒæ¨¡å—ä¸­å¯¹åº”çš„ import éƒ¨åˆ†ï¼ŒæŒ‡å‘å¯¹åº”çš„ export å†…å­˜åœ°å€ã€‚JS å¼•æ“ä¼šæ·±åº¦ä¼˜å…ˆéå†æ¨¡å—æ ‘ï¼Œæ­¤æ—¶å˜é‡å’Œå‡½æ•°åªåˆ†é…å†…å­˜åœ°å€ï¼Œæ²¡æœ‰å€¼ã€‚èµ‹å€¼åœ¨æœ€åä¸€æ­¥è¿›è¡Œã€‚
> ```

### é—­åŒ…å®ç°æ¨¡å—åŒ–

> ```js
> /* çŠ¶æ€æ¨¡å—ï¼ˆå­˜å˜é‡ï¼‰ */
> var module_status = (function () {
>   var status = {
>     number: 0,
>     color: null,
>   };
>   var get = function (prop) {
>     return status[prop];
>   };
>   var set = function (prop, value) {
>     status[prop] = value;
>   };
>   return { get, set, };
> })();
> 
> /* åŠŸèƒ½æ¨¡å—ï¼ˆè°ƒç”¨çŠ¶æ€ï¼‰ */
> var module_color = (function () {
>   //ç”¨è¿™ç§æ–¹å¼æ‰§è¡Œç¬¬äºŒæ­¥å¼•å…¥æ“ä½œï¼Œç±»ä¼¼ import state from 'module_status'
>   var state = module_status;
>   var colors = ["orange", "#ccc", "pink"];
>   function render() {
>     state.set("color", colors[state.get("number") % colors.length])
>     console.log(state.get('color'));
>   }
>   return { render, };
> })();
> var module_context = (function () {
>   var state = module_status;
>   function render() {
>     console.log("this Number is" + state.get("number"));
>   }
>   return { render, };
> })();
> 
> /* ä¸»æ¨¡å—ï¼ˆæ‰§è¡ŒåŠŸèƒ½æ¨¡å—ï¼‰ */
> var module_main = (function () {
>   var state = module_status;
>   var color = module_color;
>   var context = module_context;
> 
>   setInterval(function () {
>     state.set("number", state.get("number") + 1);
>     color.render();
>     context.render();
>   }, 1000);
> })();
> ```

## æ¨¡å—æ–¹æ³•

### åŠ¨æ€å¯¼å…¥ `import()`

> åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨é™æ€å¯¼å…¥ï¼Œå®ƒåªæ¥å—æ¨¡å—è·¯å¾„çš„å­—ç¬¦ä¸²ã€‚ä½¿ç”¨åŠ¨æ€å¯¼å…¥ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ Promise æœ‰æ¡ä»¶åœ°å¯¼å…¥æ¨¡å—ã€‚
>
> ```html
> <nav>
>   <a href="books.html" data-entry-module="books">Books</a>
>   <a href="movies.html" data-entry-module="movies">Movies</a>
>   <a href="video-games.html" data-entry-module="video-games">Video Games</a>
> </nav>
> 
> <main>Content will load here!</main>
> ```
>
> ```js
> const main = document.querySelector('main')
> for (const link of document.querySelectorAll('nav > a')) {
>   link.addEventListener('click', (e) => {
>     e.preventDefault()
> 
>     import(`./section-modules/${link.dataset.entryModule}.js`)
>       .then((module) => {
>       module.loadPageInto(main)
>     })
>       .catch((err) => {
>       main.textContent = err.message
>     })
>   })
> }
> ```
>

### `import.meta`

> ç”¨äºä¿å­˜æœ‰å…³å½“å‰æ¨¡å—çš„ç‰¹å®šäºä¸»æœºçš„å…ƒæ•°æ®çš„**å…ƒå±æ€§**ã€‚
>
> ```js
> ;(async () => {
>   const response = await fetch(new URL('../hamsters.jpg', import.meta.url))
>   const blob = await response.blob()
> 
>   const size = import.meta.scriptElement.dataset.size || 300
> 
>   const image = new Image()
>   image.src = URL.createObjectURL(blob)
>   image.width = image.height = size
> 
>   document.body.appendChild(image)
> })()
> ```
>

### `export * as ns from 'mod'`

```bash
### `export * as ns from 'mod'`
è¯­æ³•ï¼š`export * as nameSpaceStr from 'modulePath'`


- ä¸ºäº†ç¡®ä¿æœ‰ä¸€ä¸ªé»˜è®¤å¯¼å‡ºï¼Œ [Airbnb è§„èŒƒ](https://github.com/airbnb/javascript)å»ºè®®ä¸è¦ä½¿ç”¨é€šé…ç¬¦å¯¼å…¥ã€‚
- ä¸è¦ç›´æ¥ä» import ä¸­ exportï¼Œä½¿ç”¨ä¸€ç§æ¸…æ™°çš„å¯¼å…¥æ–¹å¼å’Œä¸€ç§æ¸…æ™°çš„å¯¼å‡ºæ–¹å¼å¯ä»¥ä½¿äº‹æƒ…ä¿æŒä¸€è‡´ã€‚
```

```js
export * as ns from './utils'

// ğŸ‘† ç­‰åŒäº ğŸ‘‡
import * as ns from './utils'
export { ns }
```

**ç¡®ä¿å­˜åœ¨ä¸€ä¸ªé»˜è®¤å¯¼å‡º**

```js
// bad
import * as AirbnbStyleGuide from './AirbnbStyleGuide'

// good
import AirbnbStyleGuide from './AirbnbStyleGuide'
```

```js
// bad
export { es6 as default } from './AirbnbStyleGuide'

// good
import { es6 } from './AirbnbStyleGuide'
export default es6
```



## æ­£åˆ™è¡¨è¾¾å¼  RegExp

> ```bash
> ### æ­£åˆ™è¡¨è¾¾å¼ RegExp 
> 
> ### æ­£åˆ™ä½œç”¨
>     - æ£€ç´¢ã€æ›¿æ¢ç¬¦åˆæŸä¸ªæ¨¡å¼ï¼ˆè§„åˆ™ï¼‰çš„æ–‡æœ¬
>     - è¿‡æ»¤é¡µé¢å†…å®¹ä¸­çš„ä¸€äº›æ•æ„Ÿè¯ï¼ˆæ›¿æ¢ï¼‰
>     - ä»å­—ç¬¦ä¸²ä¸­è·å–ç‰¹å®šéƒ¨åˆ†ï¼ˆæå–ï¼‰
> 
> 
> 
> ### åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼
> 1. é€šè¿‡ `RegExp` å¯¹è±¡çš„æ„é€ å‡½æ•°åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼
> 		- `let reg = new RegExp(/æ­£åˆ™è¡¨è¾¾å¼/)`
> 		- `let reg = new RegExp(å­—ç¬¦ä¸², åŒ¹é…æ¨¡å¼ä¿®é¥°ç¬¦Flag)`
> 
> 2. é€šè¿‡å­—é¢é‡åˆ›å»º
> 		- `let reg = /è¡¨è¾¾å¼/`
> 		- `let reg = /æ­£åˆ™è¡¨è¾¾å¼/åŒ¹é…æ¨¡å¼`
> 
> 
> 
> ### å­—ç¬¦ä¸²çš„æ­£åˆ™æ–¹æ³•
> å­—ç¬¦ä¸²å¯¹è±¡å…±æœ‰ 4 ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼šmatch()ã€replace()ã€search()å’Œsplit()ã€‚
> ES6 å°†è¿™ 4 ä¸ªæ–¹æ³•ï¼Œåœ¨è¯­è¨€å†…éƒ¨å…¨éƒ¨è°ƒç”¨RegExpçš„å®ä¾‹æ–¹æ³•ï¼Œä»è€Œåšåˆ°æ‰€æœ‰ä¸æ­£åˆ™ç›¸å…³çš„æ–¹æ³•ï¼Œå…¨éƒ½å®šä¹‰åœ¨RegExpå¯¹è±¡ä¸Šã€‚
>     - String.prototype.match è°ƒç”¨ RegExp.prototype[Symbol.match]
>     - String.prototype.replace è°ƒç”¨ RegExp.prototype[Symbol.replace]
>     - String.prototype.search è°ƒç”¨ RegExp.prototype[Symbol.search]
>     - String.prototype.split è°ƒç”¨ RegExp.prototype[Symbol.split]
> 
> ```

### åŒ¹é…æ¨¡å¼

> ```bash
> ## åŒ¹é…æ¨¡å¼
> ### `i`ï¼šæŒ‡å¿½ç•¥å¤§å°å†™ ignore
> 
> 
> ### `g`ï¼šæŒ‡å…¨å±€åŒ¹é…æ¨¡å¼ global
>     - å…¨å±€åŒ¹é…æ¨¡å¼`g`ä¸€èˆ¬ç”¨äº `exec()ã€match()ã€replace()` ç­‰æ–¹æ³•
>     - å…¨å±€åŒ¹é…æ¨¡å¼`g`å¦‚æœç”¨äºtest()æ–¹æ³•ä¼šæœ‰é—®é¢˜ã€‚å› ä¸ºgæ¨¡å¼ä¼šç”Ÿæˆä¸€ä¸ª`lastindex`å‚æ•°æ¥å­˜å‚¨åŒ¹é…æœ€åä¸€æ¬¡çš„ä½ç½®ã€‚
> 
> 
> ### `y`ï¼šæŒ‡é»è¿ sticky
>     - ç±»ä¼¼å…¨å±€åŒ¹é…ï¼Œåä¸€æ¬¡åŒ¹é…éƒ½ä»ä¸Šä¸€æ¬¡åŒ¹é…æˆåŠŸçš„ä¸‹ä¸€ä¸ªä½ç½®å¼€å§‹ï¼›
>     - `g`ä¿®é¥°ç¬¦åªè¦å‰©ä½™ä½ç½®ä¸­å­˜åœ¨åŒ¹é…å°±è¡Œï¼Œè€Œ`y`ä¿®é¥°ç¬¦ç¡®ä¿åŒ¹é…å¿…é¡»ä»å‰©ä½™çš„ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ã€‚
> 
> 
> ### `u` ä¿®é¥°ç¬¦ï¼šå«ä¹‰ä¸º Unicode æ¨¡å¼
> 		- ç”¨æ¥æ­£ç¡®å¤„ç†å¤§äº`\uFFFF` çš„ Unicode å­—ç¬¦ï¼Œå³ä¼šæ­£ç¡®å¤„ç†å››ä¸ªå­—èŠ‚çš„UTF-16ç¼–ç ã€‚
> 		- åœ¨ ES5 ä¸­ä¸æ”¯æŒå››ä¸ªå­—èŠ‚çš„ UTF-16 ç¼–ç ï¼Œä¼šå°†å…¶è¯†åˆ«ä¸ºä¸¤ä¸ªå­—ç¬¦ï¼›åŠ ä¸Š `u` ä¿®é¥°ç¬¦åï¼ŒES6å°±ä¼šè¯†åˆ«å…¶ä¸ºä¸€ä¸ªå­—ç¬¦ã€‚
> 		- å¦‚ï¼š`/ğ ®·{2}/u.test('ğ ®·ğ ®·') === true`ã€‚
>           /^\uD83D/u.test('\uD83D\uDC2A') // false
>           /^\uD83D/.test('\uD83D\uDC2A') // true
> 
> 
> ### `.` ä¿®é¥°ç¬¦ï¼šå«ä¹‰æ˜¯é™¤äº†æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦
> 		- å¯¹äºç ç‚¹å¤§äº0xFFFFçš„ Unicode å­—ç¬¦ï¼Œç‚¹å­—ç¬¦ä¸èƒ½è¯†åˆ«ï¼Œå¿…é¡»åŠ ä¸Šuä¿®é¥°ç¬¦ã€‚
> 
> 
> 
> ### `s` ä¿®é¥°ç¬¦ï¼šdotAll æ¨¡å¼
> æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œç‚¹ï¼ˆ.ï¼‰æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œä»£è¡¨ä»»æ„çš„å•ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªä¾‹å¤–ã€‚ä¸€ä¸ªæ˜¯å››ä¸ªå­—èŠ‚çš„ UTF-16 å­—ç¬¦ï¼Œè¿™ä¸ªå¯ä»¥ç”¨uä¿®é¥°ç¬¦è§£å†³ï¼›å¦ä¸€ä¸ªæ˜¯è¡Œç»ˆæ­¢ç¬¦ï¼ˆline terminator characterï¼‰ã€‚
> æ‰€è°“è¡Œç»ˆæ­¢ç¬¦ï¼Œå°±æ˜¯è¯¥å­—ç¬¦è¡¨ç¤ºä¸€è¡Œçš„ç»ˆç»“ã€‚ä»¥ä¸‹å››ä¸ªå­—ç¬¦å±äºâ€œè¡Œç»ˆæ­¢ç¬¦â€ã€‚
>     - U+000A æ¢è¡Œç¬¦ï¼ˆ\nï¼‰
>     - U+000D å›è½¦ç¬¦ï¼ˆ\rï¼‰
>     - U+2028 è¡Œåˆ†éš”ç¬¦ï¼ˆline separatorï¼‰
>     - U+2029 æ®µåˆ†éš”ç¬¦ï¼ˆparagraph separatorï¼‰
> 
> ```

#### `y` ä¿®é¥°ç¬¦

> ```js
> var s = 'aaa_aa_a';
> var r1 = /a+/g;
> var r2 = /a+/y;
> r1.exec(s) // ["aaa"]
> r2.exec(s) // ["aaa"]
> r1.exec(s) // ["aa"]
> r2.exec(s) // null
> 
> 
> 
> /** gä¿®é¥°ç¬¦é€šè¿‡ lastIndex æ¥æ’æŸ¥ */
> const REGEX = /a/g;
> // æŒ‡å®šä»2å·ä½ç½®ï¼ˆyï¼‰å¼€å§‹åŒ¹é…
> REGEX.lastIndex = 2;
> // åŒ¹é…æˆåŠŸ
> const match = REGEX.exec('xaya');
> // åœ¨3å·ä½ç½®åŒ¹é…æˆåŠŸ
> match.index // 3
> // ä¸‹ä¸€æ¬¡åŒ¹é…ä»4å·ä½å¼€å§‹
> REGEX.lastIndex // 4
> // 4å·ä½å¼€å§‹åŒ¹é…å¤±è´¥
> REGEX.exec('xaya') // null
> 
> 
> 
> /** yä¿®é¥°ç¬¦é€šè¿‡ lastIndex æ¥æ’æŸ¥ */
> const REGEX = /a/y;
> // æŒ‡å®šä»2å·ä½ç½®å¼€å§‹åŒ¹é…
> REGEX.lastIndex = 2;
> // ä¸æ˜¯ç²˜è¿ï¼ŒåŒ¹é…å¤±è´¥
> REGEX.exec('xaya') // null
> // æŒ‡å®šä»3å·ä½ç½®å¼€å§‹åŒ¹é…
> REGEX.lastIndex = 3;
> // 3å·ä½ç½®æ˜¯ç²˜è¿ï¼ŒåŒ¹é…æˆåŠŸ
> const match = REGEX.exec('xaya');
> match.index // 3
> REGEX.lastIndex // 4
> ```

#### `u`ä¿®é¥°ç¬¦

> ```js
> /** u ä¿®é¥°ç¬¦ */
> /^\uD83D/u.test('\uD83D\uDC2A') // false
> /^\uD83D/.test('\uD83D\uDC2A') // true
> 
> 
> /** ç‚¹ä¿®é¥°ç¬¦ ä¸ u ä¿®é¥°ç¬¦æ­é… */
> /^.$/.test('ğ ®·') // false
> /^.$/u.test('ğ ®·') // true
> // ä¸Šé¢ä»£ç å¦‚æœä¸æ·»åŠ uä¿®é¥°ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼å°±ä¼šè®¤ä¸ºå­—ç¬¦ä¸²ä¸ºä¸¤ä¸ªå­—ç¬¦ï¼Œä»è€ŒåŒ¹é…å¤±è´¥ã€‚
> 
> 
> 
> /** Unicode å­—ç¬¦è¡¨ç¤ºæ³• */
> // ä½¿ç”¨å¤§æ‹¬å·è¡¨ç¤º Unicode å­—ç¬¦ï¼Œè¿™ç§è¡¨ç¤ºæ³•åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­å¿…é¡»åŠ ä¸Š`u`ä¿®é¥°ç¬¦ï¼Œæ‰èƒ½è¯†åˆ«å½“ä¸­çš„å¤§æ‹¬å·ï¼Œå¦åˆ™ä¼šè¢«è§£è¯»ä¸ºé‡è¯ã€‚
> /\u{61}/.test('a') // false
> /\u{61}/u.test('a') // true
> /\u{20BB7}/u.test('ğ ®·') // true
> 
> 
> 
> /** é‡è¯ */
> /a{2}/.test('aa') // true
> /a{2}/u.test('aa') // true
> /ğ ®·{2}/.test('ğ ®·ğ ®·') // false
> /ğ ®·{2}/u.test('ğ ®·ğ ®·') // true
> 
> 
> 
> /** é¢„å®šä¹‰æ¨¡å¼ */
> /^\S$/.test('ğ ®·') // false
> /^\S$/u.test('ğ ®·') // true
> ```

#### `s` ä¿®é¥°ç¬¦

> æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œç‚¹ï¼ˆ`.`ï¼‰æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œä»£è¡¨ä»»æ„çš„å•ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªä¾‹å¤–ã€‚ä¸€ä¸ªæ˜¯å››ä¸ªå­—èŠ‚çš„ UTF-16 å­—ç¬¦ï¼Œè¿™ä¸ªå¯ä»¥ç”¨`u`ä¿®é¥°ç¬¦è§£å†³ï¼›å¦ä¸€ä¸ªæ˜¯è¡Œç»ˆæ­¢ç¬¦ï¼ˆline terminator characterï¼‰ã€‚
>
> æ‰€è°“è¡Œç»ˆæ­¢ç¬¦ï¼Œå°±æ˜¯è¯¥å­—ç¬¦è¡¨ç¤ºä¸€è¡Œçš„ç»ˆç»“ã€‚ä»¥ä¸‹å››ä¸ªå­—ç¬¦å±äºâ€œè¡Œç»ˆæ­¢ç¬¦â€ã€‚
>
> - U+000A æ¢è¡Œç¬¦ï¼ˆ`\n`ï¼‰
> - U+000D å›è½¦ç¬¦ï¼ˆ`\r`ï¼‰
> - U+2028 è¡Œåˆ†éš”ç¬¦ï¼ˆline separatorï¼‰
> - U+2029 æ®µåˆ†éš”ç¬¦ï¼ˆparagraph separatorï¼‰
>
> ```js
> /foo.bar/.test('foo\nbar') // false
> ```
>
> ä¸Šé¢ä»£ç ä¸­ï¼Œå› ä¸º`.`ä¸åŒ¹é…`\n`ï¼Œæ‰€ä»¥æ­£åˆ™è¡¨è¾¾å¼è¿”å›`false`ã€‚
>
> ä½†æ˜¯ï¼Œå¾ˆå¤šæ—¶å€™å¸Œæœ›åŒ¹é…çš„æ˜¯ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œè¿™æ—¶æœ‰ä¸€ç§å˜é€šçš„å†™æ³•ã€‚
>
> ```js
> /foo[^]bar/.test('foo\nbar') // true
> ```
>
> è¿™ç§è§£å†³æ–¹æ¡ˆæ¯•ç«Ÿä¸å¤ªç¬¦åˆç›´è§‰ï¼ŒES2018å¼•å…¥ `s`ä¿®é¥°ç¬¦ï¼Œä½¿å¾—`.`å¯ä»¥åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ã€‚
>
> ```js
> /foo.bar/s.test('foo\nbar') // true
> ```
>
> è¿™è¢«ç§°ä¸º`dotAll`æ¨¡å¼ï¼Œå³ç‚¹ï¼ˆdotï¼‰ä»£è¡¨ä¸€åˆ‡å­—ç¬¦ã€‚æ‰€ä»¥ï¼Œæ­£åˆ™è¡¨è¾¾å¼è¿˜å¼•å…¥äº†ä¸€ä¸ª`dotAll`å±æ€§ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦å¤„åœ¨`dotAll`æ¨¡å¼ã€‚
>
> ```js
> const re = /foo.bar/s;
> 
> // å¦ä¸€ç§å†™æ³•
> const re = new RegExp('foo.bar', 's');
> re.test('foo\nbar') // true
> re.dotAll // true
> re.flags // 's'
> ```
>
> `/s`ä¿®é¥°ç¬¦å’Œå¤šè¡Œä¿®é¥°ç¬¦`/m`ä¸å†²çªï¼Œä¸¤è€…ä¸€èµ·ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œ`.`åŒ¹é…æ‰€æœ‰å­—ç¬¦ï¼Œè€Œ`^`å’Œ`$`åŒ¹é…æ¯ä¸€è¡Œçš„è¡Œé¦–å’Œè¡Œå°¾ã€‚

#### dotAll æ¨¡å¼

> **dotAll æ¨¡å¼**ï¼Œå³ç‚¹ï¼ˆdotï¼‰ä»£è¡¨ä¸€åˆ‡å­—ç¬¦ã€‚æ‰€ä»¥ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¸­ç‚¹ï¼ˆ`.`ï¼‰åŒ¹é…é™¤è¡Œç»ˆæ­¢ç¬¦å¤–çš„ä»»ä½•å•å­—ç¬¦ï¼ŒES9 å¼•å…¥ `s` ä¿®é¥°ç¬¦å¯ä»¥æ”¹å˜è¿™ç§è¡Œä¸ºï¼Œå…è®¸**è¡Œç»ˆæ­¢ç¬¦ï¼ˆline terminator characterï¼‰**çš„å‡ºç°ã€‚
>
> æ‰€è°“è¡Œç»ˆæ­¢ç¬¦ï¼Œå°±æ˜¯è¯¥å­—ç¬¦è¡¨ç¤ºä¸€è¡Œçš„ç»ˆç»“ã€‚ä»¥ä¸‹å››ä¸ªå­—ç¬¦å±äºâ€œè¡Œç»ˆæ­¢ç¬¦â€ã€‚
>
> - U+000A æ¢è¡Œç¬¦ï¼ˆ`\n`ï¼‰
> - U+000D å›è½¦ç¬¦ï¼ˆ`\r`ï¼‰
> - U+2028 è¡Œåˆ†éš”ç¬¦ï¼ˆline separatorï¼‰
> - U+2029 æ®µåˆ†éš”ç¬¦ï¼ˆparagraph separatorï¼‰
>
> ```js
> ;/hello.world/.test('hello\nworld') / // false
> /hello.world/s.test('hello\nworld') // true
> ```
>
> æ­£åˆ™è¡¨è¾¾å¼è¿˜å¼•å…¥äº†ä¸€ä¸ª `dotAll` å±æ€§ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦å¤„åœ¨ `dotAll` æ¨¡å¼ã€‚
>
> ```js
> const reg = /foo.bar/s
> 
> reg.test('foo\nbar') // true
> reg.dotAll // true
> reg.flags // 's'
> ```
>
> `/s` ä¿®é¥°ç¬¦å’Œå¤šè¡Œä¿®é¥°ç¬¦ `/m` ä¸å†²çªï¼Œä¸¤è€…ä¸€èµ·ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œ`.` åŒ¹é…æ‰€æœ‰å­—ç¬¦ï¼Œè€Œ `^` å’Œ `$` åŒ¹é…æ¯ä¸€è¡Œçš„è¡Œé¦–å’Œè¡Œå°¾ã€‚

### `[]` å…ƒå­—ç¬¦

#### [ å€¼- å€¼] èŒƒå›´

> - `/[ab]/` ç­‰ä»·äº `/a|b/`ï¼šæ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å« **aæˆ–b**
> - `/[a-z]/`ï¼šæ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²é‚£ç§æ˜¯å¦åŒ…å«**ä»»æ„å°å†™å­—æ¯**
> - `/[A-Z]/`ï¼šä»»æ„å¤§å†™å­—æ¯
> - `/[A-z]/`ï¼šä»»æ„å­—æ¯
> - `/[0-9]/`ï¼šä»»æ„æ•°å­—
> - `[a-z0-9A-Z]`ï¼šä»»æ„æ•°å­—ã€å­—æ¯
> - `/a[bde]c/`ï¼šæ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å« abc æˆ– adc æˆ– aec

#### `[^å€¼]`  æ’é™¤

> ```javascript
> // ä¸¾ä¾‹1ï¼š
> var reg = /[^ab]/; // è§„åˆ™ï¼šå­—ç¬¦ä¸²ä¸­ï¼Œé™¤äº†aã€bä¹‹å¤–ï¼Œè¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„å­—ç¬¦å†…å®¹ï¼Ÿ
> var str = "acb";
> console.log(reg.test(str)); // æ‰“å°ç»“æœï¼štrue
> 
> // ä¸¾ä¾‹2ï¼šï¼ˆå¯ä»¥ç”¨æ¥éªŒè¯æŸå­—ç¬¦ä¸²æ˜¯å¦ä¸º çº¯æ•°å­—ï¼‰
> var reg = /[^0-9]/;  // è§„åˆ™ï¼šå­—ç¬¦ä¸²ä¸­ï¼Œé™¤äº†æ•°å­—ä¹‹å¤–ï¼Œè¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„å†…å®¹ï¼Ÿ
> var str1 = "1991";
> var str2 = "199a1";
> 
> console.log(reg.test(str1)); // æ‰“å°ç»“æœï¼šfalse ï¼ˆå¦‚æœå­—ç¬¦ä¸²æ˜¯ çº¯æ•°å­—ï¼Œåˆ™è¿”å› falseï¼‰
> console.log(reg.test(str2)); // æ‰“å°ç»“æœï¼štrue
> ```

### è½¬ä¹‰å­—ç¬¦

> - `.`(ç‚¹) ï¼šä»»æ„å­—ç¬¦
> - `\d` (æ•°å­—)ï¼š`[0-9]`
> - `\w` (æ•°å­—ã€è‹±æ–‡ã€ä¸‹åˆ’çº¿) ï¼š`[a-z0-9_]`
> - `\s` (ç©ºç™½å­—ç¬¦)ï¼š`[ ]`
> - `\D` (é™¤äº†æ•°å­—)ï¼š`[^0-9]`
> - `\W` (é™¤äº†æ•°å­—è‹±æ–‡ä¸‹åˆ’çº¿) ï¼š`[^a-z0-9_]`
> - `\S` (é™¤äº†ç©ºç™½å­—ç¬¦)ï¼š`[^ ]`
> - ``^` ï¼šè¡Œé¦–
> - `$`ï¼šè¡Œå°¾

### é‡è¯

> - `{n}`ï¼šåˆšå¥½å‡ºç° n æ¬¡
> - `{n,m}` è‡³å°‘å‡ºç° n æ¬¡ï¼Œæœ€å¤š m æ¬¡
> - `{n,}` è‡³å°‘ n æ¬¡ï¼Œæ— ä¸Šé™
> - `*` ä»»æ„æ¬¡ `{0,}` å¯ä»¥ä¸º0æ¬¡ï¼Œä¸å»ºè®®ä½¿ç”¨
> - `ï¼Ÿ` é›¶æ¬¡æˆ–ä¸€æ¬¡ `{0,1}`
> - `+` ä¸€æ¬¡æˆ–ä»»æ„æ¬¡`{1,}`
>
> ```js
> // å›ºå®šç”µè¯:010-23456789-1234 æˆ– 23456789
> (0\d{2,3}-)?[1-9]\d{7}(-\d{1,5})?
> ```

### RegExp å‘½åæ•è·ç»„`?<name>`

> JavaScript æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥è¿”å›ä¸€ä¸ªåŒ¹é…çš„å¯¹è±¡ â€”â€” ä¸€ä¸ªåŒ…å«åŒ¹é…å­—ç¬¦ä¸²çš„ç±»æ•°ç»„ï¼Œä¾‹å¦‚ï¼šä»¥ `YYYY-MM-DD` çš„æ ¼å¼è§£ææ—¥æœŸï¼š
>
> ```js
> const reDate = /([0-9]{4})-([0-9]{2})-([0-9]{2})/,
> match = reDate.exec('2018-04-30'),
> year = match[1], // 2018
> month = match[2], // 04
> day = match[3] // 30
> ```
>
> è¿™æ ·çš„ä»£ç å¾ˆéš¾è¯»æ‡‚ï¼Œå¹¶ä¸”æ”¹å˜æ­£åˆ™è¡¨è¾¾å¼çš„ç»“æ„æœ‰å¯èƒ½æ”¹å˜åŒ¹é…å¯¹è±¡çš„ç´¢å¼•ã€‚
>
> ES9 å…è®¸å‘½åæ•è·ç»„ä½¿ç”¨ç¬¦å· `?<name>`ï¼Œåœ¨æ‰“å¼€æ•è·æ‹¬å· `(` åç«‹å³å‘½åï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š
>
> ```js
> const reDate = /(?<year>[0-9]{4})-(?<month>[0-9]{2})-(?<day>[0-9]{2})/,
> match = reDate.exec('2018-04-30'),
> year = match.groups.year, // 2018
> month = match.groups.month, // 04
> day = match.groups.day // 30
> ```
>
> ä»»ä½•åŒ¹é…å¤±è´¥çš„å‘½åç»„éƒ½å°†è¿”å› `undefined`ã€‚
>
> å‘½åæ•è·ä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨ `replace()` æ–¹æ³•ä¸­ã€‚ä¾‹å¦‚å°†æ—¥æœŸè½¬æ¢ä¸ºç¾å›½çš„ `MM-DD-YYYY` æ ¼å¼ï¼š
>
> ```js
> const reDate = /(?<year>[0-9]{4})-(?<month>[0-9]{2})-(?<day>[0-9]{2})/,
> d = '2018-04-30',
> usDate = d.replace(reDate, '$<month>-$<day>-$<year>')
> ```

### RegExp Unicode å±æ€§è½¬ä¹‰

> åœ¨ ES9 ä¹‹å‰ï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­è®¿é—® Unicode å­—ç¬¦å±æ€§æ˜¯ä¸è¢«å…è®¸çš„ã€‚
>
> ES9 æ·»åŠ äº† Unicode å±æ€§è½¬ä¹‰ï¼Œå½¢å¼ä¸º `\p{...}` å’Œ `\P{...}`ï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ ‡è®° `u` ï¼ˆunicodeï¼‰è®¾ç½®ï¼Œåœ¨ `\p` å—å†…ï¼Œå¯ä»¥ä»¥é”®å€¼å¯¹çš„æ–¹å¼è®¾ç½®éœ€è¦åŒ¹é…çš„å±æ€§è€Œéå…·ä½“å†…å®¹ã€‚ä¾‹å¦‚ï¼š
>
> ```js
> const reGreekSymbol = /\p{Script=Greek}/u
> reGreekSymbol.test('Ï€') // true
> ```
>
> æ­¤ç‰¹æ€§å¯ä»¥é¿å…ä½¿ç”¨ç‰¹å®š Unicode åŒºé—´æ¥è¿›è¡Œå†…å®¹ç±»å‹åˆ¤æ–­ï¼Œæå‡å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

### æ£€æµ‹`test()`

> ```bash
> ## æ£€æµ‹ test()
> - `regExp.test(è¦æµ‹è¯•çš„æ–‡æœ¬str)`ï¼šåªè¦æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œå°±è¿”å› true
> - å¯¹äº 'éå…¨å±€åŒ¹é…' çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œtest() åªä¼šæ£€æµ‹ 'æ˜¯å¦å­˜åœ¨æŸä¸ªç›®æ ‡å­—ç¬¦ä¸²'(åªè¦å­˜åœ¨å°±ä¸º true)ï¼Œå¤šæ¬¡æ£€æµ‹çš„è§è¿‡éƒ½ç›¸åŒã€‚
> - æ³¨æ„ï¼šå…¨å±€åŒ¹é… g æ…ç”¨ test() æ–¹æ³•ï¼Œå› ä¸ºæ¯æ¬¡æ£€æµ‹çš„ç»“æœå¯èƒ½ä¼šå‡ºç°ä¸ä¸€è‡´ã€‚
> ```
>
> ```js
> const reg = /test/g;
> const str = '_test_test';
> 
> console.log(reg.test(str)); // true
> console.log(reg.lastIndex); // 5
> 
> console.log(reg.test(str)); // true
> console.log(reg.lastIndex); // 10
> 
> console.log(reg.test(str)); // false
> console.log(reg.lastIndex); // 0
> ```

### RegExp åå‘æ–­è¨€ï¼ˆlookbehindï¼‰

> ç›®å‰ JavaScript åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æ”¯æŒå…ˆè¡Œæ–­è¨€ï¼ˆlookaheadï¼‰ã€‚è¿™æ„å‘³ç€åŒ¹é…ä¼šå‘ç”Ÿï¼Œä½†ä¸ä¼šæœ‰ä»»ä½•æ•è·ï¼Œå¹¶ä¸”æ–­è¨€æ²¡æœ‰åŒ…å«åœ¨æ•´ä¸ªåŒ¹é…å­—æ®µä¸­ã€‚ä¾‹å¦‚ä»ä»·æ ¼ä¸­æ•è·è´§å¸ç¬¦å·ï¼š
>
> ```js
> const reLookahead = /\D(?=\d+)/
> const match = reLookahead.exec('$123.89')
> 
> console.log(match[0]) // $
> ```
>
> ES9 å¼•å…¥ä»¥ç›¸åŒæ–¹å¼å·¥ä½œä½†æ˜¯åŒ¹é…å‰é¢çš„åå‘æ–­è¨€ï¼ˆlookbehindï¼‰ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥å¿½ç•¥è´§å¸ç¬¦å·ï¼Œå•çº¯çš„æ•è·ä»·æ ¼çš„æ•°å­—ï¼š
>
> ```js
> const reLookbehind = /(?<=\D)\d+/
> const match = reLookbehind.exec('$123.89')
> 
> console.log(match[0]) // 123.89
> ```
>
> ä»¥ä¸Šæ˜¯**è‚¯å®šåå‘æ–­è¨€**ï¼Œéæ•°å­— `\D` å¿…é¡»å­˜åœ¨ã€‚åŒæ ·çš„ï¼Œè¿˜å­˜åœ¨**å¦å®šåå‘æ–­è¨€**ï¼Œè¡¨ç¤ºä¸€ä¸ªå€¼å¿…é¡»ä¸å­˜åœ¨ï¼Œä¾‹å¦‚ï¼š
>
> ```js
> const reLookbehindNeg = /(?<!\D)\d+/
> const match = reLookbehind.exec('$123.89')
> 
> console.log(match[0]) // null
> ```

### æ›¿æ¢`replace()`

> ```bash
> ## æ›¿æ¢ replace()
> - `replace()`ï¼šå°†å­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šå†…å®¹æ›¿æ¢ä¸ºæ–°çš„å†…å®¹å¹¶è¿”å›ã€‚ä¸ä¼šä¿®æ”¹åŸå­—ç¬¦ä¸²ã€‚
> - `æ–°çš„å­—ç¬¦ä¸² = åŸå­—ç¬¦ä¸².replace(è¢«æ›¿æ¢çš„å†…å®¹, è¦æ›¿æ¢çš„æ–°å†…å®¹)`
> 
> - å¯¹äºä¸å¸¦æ ‡å¿— `/g` çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œreplace() åªè®¿é—®ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ã€‚
> - è‹¥åœ¨æ­£åˆ™è¡¨è¾¾è¿˜æ˜¯åé¢åŠ ä¸Š `/g`ï¼Œreplace() ä¼šæ‰§è¡Œå¤šæ¬¡ã€‚
> 
> 
> 
> ### replaceAll()
> - `replaceAll()` æ›¿æ¢æ­£åˆ™è¡¨è¾¾å¼æˆ–å­—ç¬¦ä¸²çš„æ‰€æœ‰åŒ¹é…é¡¹ã€‚
> - `String.prototype.replaceAll(searchValue, replaceValue)`
> 		- `searchValue` å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼ã€‚
> 		
> 		- `.*` â€” å•ä¸ªå­—ç¬¦åŒ¹é…ä»»æ„æ¬¡ï¼Œå³è´ªå©ªåŒ¹é…
>     - `u` â€” Unicode æ¨¡å¼
>     - `g` â€” å…¨å±€åŒ¹é…ï¼ŒæŸ¥æ‰¾æ‰€æœ‰çš„åŒ¹é…é¡¹
> ```
>
> ```js
> var str2 = "Today is fine day,today is fine day !!!"
> console.log(str2.replace("today", "tomorrow"));  //åªèƒ½æ›¿æ¢ç¬¬ä¸€ä¸ªtoday
> console.log(str2.replace(/today/gi, "tomorrow")); //è¿™é‡Œç”¨åˆ°äº†æ­£åˆ™ä¸ºâ€œå…¨å±€åŒ¹é…â€æ¨¡å¼ï¼Œæ‰èƒ½æ›¿æ¢æ‰€æœ‰çš„today
> 
> 
> /** replace */
> const regExp = /^([A-Za-z]+): (.*)$/gu
> 'first: Jane'.replaceAll(regExp, 'KEY: $1, VALUE: $2') // 'KEY: first, VALUE: Jane'
> 
> 
> /** replaceAll() å¯¹æ’å…¥å‘½åç»„çš„æ•è· */
> const regExp = /^(?<key>[A-Za-z]+): (?<value>.*)$/gu
> 'first: Jane'.replaceAll(regExp, 'KEY: $<key>, VALUE: $<value>') // 'KEY: first, VALUE: Jane'
> ```

### æœç´¢`search()`

> - `search()`ï¼šæœç´¢å­—ç¬¦ä¸²ä¸­æ˜¯å¦å«æœ‰æŒ‡å®šå†…å®¹ï¼Œè¿”å›æŒ‡å®šå†…å®¹ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼›å¦åˆ™è¿”å›-1ï¼ˆæ³¨æ„ï¼šsearchåªä¼šæŸ¥æ‰¾ä¸€ä¸ªï¼Œå³ä½¿è®¾ç½®å…¨å±€åŒ¹é…ä¹Ÿæ— æ•ˆï¼‰
>
> ```js
> var str = "hello abc hello aec afc";
> // æœç´¢å­—ç¬¦ä¸²ä¸­æ˜¯å¦å«æœ‰abc æˆ– aec æˆ– afc
> console.log(str.search(/a[bef]c/));	 // 6
> ```

### æå–`match()`

> ```bash
> ## æå– match()
> - `match()`ï¼šæ ¹æ®æ­£åˆ™è¡¨è¾¾å¼ä»ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­å°†ç¬¦åˆæ¡ä»¶çš„å†…å®¹æå–å‡ºæ¥ï¼Œå°è£…åˆ°ä¸€ä¸ªæ•°ç»„ä¸­è¿”å›ã€‚
> 
> æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œ`match()` æ–¹æ³•åªæ‰¾åˆ° 'ç¬¬ä¸€ä¸ª' ç¬¦åˆè¦æ±‚çš„å†…å®¹åå°±åœæ­¢æ£€ç´¢ï¼Œä½†æ˜¯è®¾ç½®æ­£åˆ™è¡¨è¾¾å¼ä¸º 'å…¨å±€åŒ¹é…' æ¨¡å¼ï¼Œå°±ä¼šåŒ¹é…åˆ°æ‰€æœ‰ç›¸å…³çš„å†…å®¹ï¼Œå¹¶ä»¥ 'æ•°ç»„' çš„å½¢å¼è¿”å›ã€‚
> 
> 
> 
> ### æå–æ‰€æœ‰åŒ¹é…é¡¹ matchAll()
> - ES2020 å¢åŠ  `String.prototype.matchAll()` æ–¹æ³•ï¼Œå¯ä»¥ä¸€æ¬¡æ€§æå–æ‰€æœ‰åŒ¹é…ã€‚ä¸è¿‡ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªéå†å™¨(Iterator)ï¼Œè€Œä¸æ˜¯æ•°ç»„ã€‚
> 
> - ç”±äº `string.matchAll(regex)` è¿”å›çš„æ˜¯éå†å™¨ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ `for...of` å¾ªç¯å–å‡ºã€‚ç›¸å¯¹äºè¿”å›æ•°ç»„ï¼Œè¿”å›éå†å™¨çš„å¥½å¤„åœ¨äºï¼Œå¦‚æœåŒ¹é…ç»“æœæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ç»„ï¼Œé‚£ä¹ˆéå†å™¨æ¯”è¾ƒèŠ‚çœèµ„æºã€‚
> éå†å™¨å¯ä»¥ä½¿ç”¨ `...`è¿ç®—ç¬¦ å’Œ `Array.from()` æ–¹æ³•æ¥è½¬ä¸ºæ•°ç»„ã€‚
> ```
>
> ```js
> /** match() */
> var str = "1aae6A8B";
> var r1 = str.match(/[a-z]/);   // æ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„ç¬¬ä¸€ä¸ªå†…å®¹ï¼Œç„¶åè¿”å›
> var r2 = str.match(/[a-z]/g);  // è®¾ç½®ä¸ºâ€œå…¨å±€åŒ¹é…â€æ¨¡å¼ï¼ŒåŒ¹é…å­—ç¬¦ä¸²ä¸­ æ‰€æœ‰çš„å°å†™å­—æ¯
> var r3 = str.match(/[a-z]/gi); // è®¾ç½®å¤šä¸ªåŒ¹é…æ¨¡å¼ï¼ŒåŒ¹é…å­—ç¬¦ä¸²ä¸­ æ‰€æœ‰çš„å­—æ¯ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰
> console.log(r1, r2, r3); // æ‰“å°ç»“æœï¼š["a"], ["a", "a", "e"], ["a", "a", "e", "A", "B"]
> 
> 
> /** matchAll() */
> const string = 'test1test2test3';
> // g ä¿®é¥°ç¬¦åŠ ä¸åŠ éƒ½å¯ä»¥
> const regex = /t(e)(st(\d?))/g;
> for (const match of string.matchAll(regex)) {
>   console.log(match);
> }
> // ["test1", "e", "st1", "1", index: 0, input: "test1test2test3"]
> // ["test2", "e", "st2", "2", index: 5, input: "test1test2test3"]
> // ["test3", "e", "st3", "3", index: 10, input: "test1test2test3"]
> 
> 
> // è½¬ä¸ºæ•°ç»„æ–¹æ³•ä¸€
> [...string.matchAll(regex)]
> // è½¬ä¸ºæ•°ç»„æ–¹æ³•äºŒ
> Array.from(string.matchAll(regex))
> ```

### æ‹†åˆ†`split()`

> - `split()` å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼æŒ‡å®šåˆ†éš”ç¬¦æ¥è¿›è¡Œæ‹†åˆ†å­—ç¬¦ä¸²æˆä¸€ä¸ªæ•°ç»„ã€‚
>   - å¦‚æœè¯¥æ­£åˆ™è¡¨è¾¾å¼è‡³å°‘åŒ…å«ä¸€ä¸ªæ•è·ç»„ï¼Œåˆ™ `split()` è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­å­å­—ç¬¦ä¸²ä¸ç¬¬ä¸€ä¸ªç»„æ•è·çš„å†…å®¹äº¤é”™
>
> ```js
> const str = "11a22b33c44d55e66f77g"
> const regExp = /[A-z]/
> const result = str.split(regExp) // å‚æ•°æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼šè¡¨ç¤ºæ‰€æœ‰å­—æ¯
> console.log(result)  // [ '11', '22', '33', '44', '55', '66', '77', '' ]
> 
> 
> const regExp1 = /<(-+)>/gu
> const str1 = 'a<--->b<->c'
> str1.split(regExp1) // [ 'a', '---', 'b', '-', 'c' ]
> ```

### RegExp.prototype.exec()

> åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ”¶é›†æ•°ç»„åŒ¹é…ä¸­ç»„ 1 çš„æ‰€æœ‰æ•è·ï¼š
>
> ```js
> function collectGroup1(regExp, str) {
>   const matches = []
>   while (true) {
>     const match = regExp.exec(str)
>     if (match === null) break
>     // å°†ç»„ 1 çš„æ•è·æ·»åŠ åˆ° matches
>     matches.push(match[1])
>   }
>   return matches
> }
> 
> collectGroup1(/"([^"]*)"/gu, `"foo" and "bar" and "baz"`) // [ 'foo', 'bar', 'baz' ]
> ```
>
> æ²¡æœ‰æ ‡å¿— `/g`ï¼Œ`exec()` å§‹ç»ˆåªè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ï¼š
>
> ```js
> const re = /[abc]/
> re.exec('abc') // [ 'a', index: 0, input: 'abc' ]
> 
> re.exec('abc') // [ 'a', index: 0, input: 'abc' ]
> ```
>
> è¿™å¯¹ `collectGroup1()` æ¥è¯´æ˜¯ä¸ªåæ¶ˆæ¯ï¼Œå› ä¸ºå¦‚æœ `regExp` æ²¡æœ‰æ ‡å¿— `/g`ï¼Œå®ƒå°†æ°¸è¿œä¸ä¼šå®Œæˆã€‚

### å¸¸è§„æ­£åˆ™

#### åŒ¹é…æ˜¯å¦åŒ…å«æ±‰å­—

```js
/** ä¼ ç»Ÿçš„åŒ¹é…æ˜¯å¦åŒ…å«æ±‰å­—ï¼šæšä¸¾æ³• */
const pattern1 = /[\u4E00-\u9FCC\u3400-\u4DB5\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\uD840-\uD868][\uDC00-\uDFFF]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|[\uD86A-\uD86C][\uDC00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]/


/** ä¼˜åŒ–åçš„åŒ¹é…æ±‰å­—è¡¨è¾¾å¼ */
const pattern = /\p{Script=Han}/u
!!'ä½ å¥½'.match(pattern) // true

```



## æ•°æ®ç»“æ„

### Set

> - `Set`æ•°æ®ç»“æ„ç±»ä¼¼äºæ•°ç»„ï¼Œä½†æˆå‘˜å€¼éƒ½æ˜¯å”¯ä¸€ã€æ²¡æœ‰é‡å¤çš„å€¼ï¼ˆå¯ç”¨äº**æœç´¢å…³é”®è¯ã€æ•°ç»„å»é‡**ï¼‰
> - `Set`æœ¬èº«æ˜¯æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ`Set`æ•°æ®ç»“æ„ï¼Œ`Set`å‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ªæ•°ç»„(æˆ–å…·æœ‰Iterableæ¥å£çš„å…¶ä»–æ•°æ®ç»“æ„)ä½œä¸ºå‚æ•°ï¼Œç”¨æ¥åˆå§‹åŒ–
> - æ³¨æ„ï¼šåœ¨Setå†…éƒ¨ä¸¤ä¸ª`NaN`æ˜¯ç›¸ç­‰çš„ï¼Œä¸¤ä¸ªå¯¹è±¡æ€»æ˜¯ä¸ç›¸ç­‰çš„
> - å®ä¾‹æ–¹æ³•
>   - `add(value)`ï¼šå¢åŠ æ–°å…ƒç´ ï¼Œè¿”å›Setç»“æ„æœ¬èº«
>   - `delete(value)`ï¼šåˆ é™¤æŒ‡å®šå…ƒç´ ï¼Œè¿”å›å¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦åˆ é™¤æˆåŠŸ
>   - `has(value)`ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œæ£€æµ‹Setæ•°æ®æ˜¯å¦æœ‰è¯¥å€¼
>   - `size()`ï¼šè¿”å›é›†åˆçš„å…ƒç´ ä¸ªæ•°
>   - `clear()`ï¼šæ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡æœ‰è¿”å›å€¼
>
> ```js
> const s = new Set();
> s.add(1).add(2).add(2) // sï¼š{1, 2}
> s.size	// 2
> s.delete(2)	// s: {1}
> s.has(2)	// false
> 
> const s1 = new Set([1, 2, 3, 4, 2, 1]);	//	{1, 2, 3, 4}
> const set = new Set(["a", "b", "a", "b"]);	//	{"a", "b"}
> const arr = [...set];	//æŠŠsetç»“æ„è½¬æ¢ä¸ºæ•°ç»„ç»“æ„ [ 'a', 'b' ]
> 
> //éå†setæ•°æ®ç»“æ„
> set.forEach(value => { console.log(value) })	//a b
> 
> /* éå†å™¨ï¼šåªèƒ½ç”¨for ofæ¥éå† */
> // Array.keys()æŒ‡çš„æ˜¯è¿”å›é”®åçš„éå†å™¨
> for (let s of arr.keys()) {
>     console.log(s); // 0 1
> }
> //.values()æŒ‡çš„æ˜¯è¿”å›é”®å€¼çš„éå†å™¨
> for (let x of arr.values()) {
>     console.log(x); // a b
> }
> //.entries()æŒ‡çš„æ˜¯è¿”å›é”®å€¼å¯¹çš„éå†å™¨
> for (let y of arr.entries()) {
>     console.log(y); // [ 0, 'a' ] [ 1, 'b' ]
> }
> 
> /* map å’Œ filteræ–¹æ³•å¯é—´æ¥ç”¨äºSet */
> let set = new Set([1, 2, 3, 4, 2, 1])
> set = new Set([...set].map(val => val * 2))
> set = new Set([...set].filter(val => (val % 2) === 0)
> ```
>
> ```js
> let set1 = new Set([1, 2, 3]), set2 = new Set([2, 1, 4]);
> // æ¨¡æ‹Ÿæ±‚äº¤é›† 
> let intersection = new Set([...set1].filter(x => set2.has(x)));
> 
> // æ¨¡æ‹Ÿæ±‚å·®é›†
> let difference = new Set([...set1].filter(x => !set2.has(x)));
> 
> // Seté›†åˆä¸æ•°ç»„äº’æ¢
> const arr = Array.from([...set1])
> const mySet = new Set(arr)
> 
> // æ•°ç»„å»é‡
> const arr = [123, [1, 2, 3], [1, "2", 3], [1, 2, 3], "meili"]
> let m  = [...new Set(arr.map(JSON.stringify))].map(JSON.parse);
> console.log(m)	// [ 123, [ 1, 2, 3 ], [ 1, '2', 3 ], 'meili' ]
> 
> // å»é™¤æ•°ç»„é‡å¤æˆå‘˜
> let arr = [...new Set([1, 2, 2, 1])]
> // å»é™¤å­—ç¬¦ä¸²çš„é‡å¤å­—ç¬¦
> let str = [...new Set('ababbc')].join('')
> ```

### WeakSet

> - `WeakSet`ä¸`Set`ç»“æ„çš„åŒºåˆ«
>   - `WeakSet`æˆå‘˜åªèƒ½æ˜¯å¯¹è±¡ï¼Œè€Œä¸èƒ½æœ‰å…¶ä»–ç±»å‹çš„å€¼ï¼ˆå¯æ¥å—æ•°ç»„æˆ–ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼‰
>   - `WeakSet`ä¸­çš„å¯¹è±¡éƒ½æ˜¯å¼±å¼•ç”¨ï¼ˆå³å½“å…¶ä»–å¯¹è±¡ä¸å†å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨å›æ”¶è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ï¼Œä½¿å¾—æˆ‘ä»¬ä¸ç”¨è€ƒè™‘å¯¹è±¡è¿˜å­˜ä¸å­˜åœ¨`WeakSet`ä¸­ï¼‰ï¼Œå¸¸ç”¨äºä¿å­˜DOMèŠ‚ç‚¹ä½¿å¾—ä¸å®¹æ˜“é€ æˆå†…å­˜æ³„æ¼
>   - æ€»ç»“ï¼šæ‰€ä»¥WeakSetçš„æˆå‘˜æ˜¯ä¸é€‚åˆå¼•ç”¨çš„ï¼Œå› ä¸ºå®ƒä¼šéšæ—¶æ¶ˆå¤±ã€‚ç”±äºå†…éƒ¨æˆå‘˜æ•°é‡å–å†³äºåƒåœ¾å›æ”¶æœºåˆ¶æ˜¯å¦è¿è¡Œï¼Œè¿è¡Œå‰åå¾ˆå¯èƒ½æˆå‘˜æ•°é‡ä¸åŒï¼Œä¸”åƒåœ¾å›æ”¶æœºåˆ¶ä½•æ—¶è¿è¡Œä¸å¯æµ‹ï¼Œæ‰€ä»¥ES6è§„å®šWeakSetä¸å¯éå†
> - `ws.add(val)`ï¼šå‘ WeakSet å®ä¾‹æ·»åŠ ä¸€ä¸ªæ–°æˆå‘˜
> - `ws.delete(val)`ï¼šæ¸…é™¤ WeakSet å®ä¾‹çš„æŒ‡å®šæˆå‘˜
> - `ws.has(val)`ï¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªå€¼æ˜¯å¦åœ¨ WeakSet å®ä¾‹ä¹‹ä¸­
>
> ```js
> const a = [[1, 2], [3, 4]];
> const ws = new WeakSet()	// WeakSet {[1, 2], [3, 4]}
> const obj = {}
> ws.add(obj)
> ws.has(obj)	// true
> ws.delete(obj)
> ```

### Map

```bash
## Map æ•°æ®ç»“æ„
- `Map` æ•°æ®ç»“æ„æ˜¯ä¸ºäº†**è§£å†³å¯¹è±¡æ— æ³•ä½¿ç”¨éå­—ç¬¦ä¸²ä½œä¸ºé”®**è€Œæå‡ºçš„æ•°æ®ç»“æ„ï¼ˆå³Mapå¯ä½¿ç”¨å„ç§ç±»å‹çš„å€¼ä½œä¸ºé”®ï¼ŒåŒ…æ‹¬å¯¹è±¡ä¹Ÿå¯ä½œä¸ºé”®ï¼‰
- `Map`æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œå…¶ä¸­æ•°ç»„å…ƒç´ æ˜¯åªåŒ…å«ä¸¤ä¸ªå…ƒç´ (é”®å€¼å¯¹)çš„æ•°ç»„ã€‚

    - è®¾ç½®é”®å€¼å¯¹ï¼š`set(key, value)`
    - è·å¾—å€¼ï¼š`get(key)`
    - åˆ é™¤é”®å€¼å¯¹ï¼š`delete(key)`
    - æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼š`clear()`

    - æ„é€ Mapå®ä¾‹ `new Map(iterable)` å‚æ•°æ˜¯ `iterable` å¯¹è±¡ã€‚
    - ç”±äº `entries()` æ–¹æ³•äº§ç”Ÿçš„å½¢å¼ä¸ Map æœ¬èº«ä¸€æ ·ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ Mapå®ä¾‹å½“å‚æ•°ä¼ å…¥
```

```js
/**
 * ä¸€èˆ¬ä½¿ç”¨
 */
const map1 = new Map()
const map2 = new Map(map1.entries()) // ç­‰ä»· let m3 = new Map(map1);
console.log(map2)

const x = { id: 1 }
const y = { id: 2 }
map1.set(x, 'foo')
map1.set(y, 'bar')

console.log(map1.has({ id: 1 }), map1.has(x)) // false true

const marr = [...map1]
console.log(marr) // [[{id: 1}, 'foo'], [{id: 2}, 'bar']]; äºŒç»´æ•°ç»„

const marr2 = [...map1.entries()] // æ•ˆæœåŒä¸Š [...map1]
console.log(marr2[0][1]) // 'foo'



/**
 * è¿­ä»£éå†
 */
const map3 = new Map([
  ['acc', 'abcd'],
  ['123', { x: 'æ‰‹æœº', y: 'ç”µè„‘' }],
  ['2 > 3', 'ä¸æ­£ç¡®'],
])
console.log(map3) // Map { 'acc' => 'abcd', 123 => { x: 'æ‰‹æœº', y: 'ç”µè„‘' }, false => 'ä¸æ­£ç¡®' }

// å¯ä»¥ç›´æ¥ä½¿ç”¨æ•°ç»„çš„foreachéå†
map3.forEach((x) => {
  console.log(x)
})

// éå†å™¨
// éå†å™¨åªèƒ½ç”¨for ofæ¥éå†
// .keys()æŒ‡çš„æ˜¯è¿”å›é”®åçš„éå†å™¨
for (const s of map3.keys()) {
  console.log(s)
}
// .values()æŒ‡çš„æ˜¯è¿”å›é”®å€¼çš„éå†å™¨
for (const a of map3.values()) {
  console.log(a)
}
// .entries()æŒ‡çš„æ˜¯è¿”å›é”®å€¼å¯¹çš„éå†å™¨
for (const y of map3.entries()) {
  console.log(y)
}

```

#### Mapå’Œ Object çš„åŒºåˆ«

```bash
### Map å’Œ Object çš„åŒºåˆ«
1. Key çš„ç±»å‹ï¼š
å¯¹è±¡ï¼ˆObjectï¼‰çš„é”®å¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–è€…Symbolsã€‚å°½ç®¡å½“ä½ ä½¿ç”¨éå­—ç¬¦ä¸²ä½œä¸ºé”®æ—¶ï¼Œå®ƒä¼šè¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚
Mapå¯ä»¥ä½¿ç”¨ä»»ä½•ç±»å‹ä½œä¸ºé”®ï¼ŒåŒ…æ‹¬å¯¹è±¡ã€å‡½æ•°ã€åŸå§‹ç±»å‹ã€‚

2. é”®çš„é¡ºåºï¼š
å¯¹è±¡ï¼ˆObjectï¼‰åœ¨ES2015ä¹‹å‰æ²¡æœ‰é”®çš„é¡ºåºä¿è¯ï¼›è€Œåœ¨ES2015åŠä¹‹åï¼Œå­—ç¬¦ä¸²é”®æŒ‰ç…§åˆ›å»ºæ—¶çš„é¡ºåºæ’åˆ—ï¼ŒSymbolé”®åˆ™æŒ‰ç…§å®ƒä»¬è¢«æ·»åŠ åˆ°å¯¹è±¡çš„é¡ºåºæ’åˆ—ã€‚
Mapåˆ™ä¼šæŒ‰ç…§å…ƒç´ æ·»åŠ çš„é¡ºåºä¿æŒé”®å€¼å¯¹çš„é¡ºåºã€‚

3. å¤§å°å¯è¿½è¸ªï¼š
å¯¹è±¡ï¼ˆObjectï¼‰æ²¡æœ‰å†…å»ºçš„æ–¹å¼æ¥è¿½è¸ªæœ‰å¤šå°‘é”®å€¼å¯¹å­˜åœ¨ã€‚
Mapæœ‰ä¸€ä¸ªsizeå±æ€§ï¼Œå¯ä»¥ç›´æ¥è·å–åˆ°Mapä¸­é”®å€¼å¯¹çš„æ•°é‡ã€‚

4. æ€§èƒ½ï¼š
å¯¹è±¡ï¼ˆObjectï¼‰åœ¨å¤„ç†å¤§é‡çš„é”®å€¼å¯¹å’Œé¢‘ç¹æ·»åŠ å’Œåˆ é™¤é”®å€¼å¯¹æ—¶ï¼Œæ€§èƒ½å¯èƒ½ä¸å¦‚Mapã€‚
Mapåœ¨é¢‘ç¹çš„æ·»åŠ å’Œåˆ é™¤é”®å€¼å¯¹çš„æ“ä½œä¸­é€šå¸¸æä¾›æ›´å¥½çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å½“æ¶‰åŠåˆ°å¤§é‡çš„é”®å€¼å¯¹æ—¶ã€‚

5. æ˜“ç”¨æ€§ï¼š
å¯¹è±¡ï¼ˆObjectï¼‰æ‹¥æœ‰å­—é¢é‡è¯­æ³•ï¼ˆ{}ï¼‰ï¼Œå¹¶ä¸”åœ¨JavaScriptä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚
Mapåˆ™éœ€è¦ä½¿ç”¨æ„é€ å‡½æ•°ï¼ˆnew Map()ï¼‰æ¥åˆ›å»ºã€‚

6. å†…å»ºæ–¹æ³•ï¼š
å¯¹è±¡ï¼ˆObjectï¼‰æœ‰ä¸€äº›å†…å»ºçš„åŸå‹æ–¹æ³•ï¼Œä½†è¿™äº›æ–¹æ³•å¯èƒ½è¢«å¯¹è±¡çš„é”®è¦†ç›–ã€‚
Mapæä¾›äº†ä¸€å¥—æ ‡å‡†çš„æ–¹æ³•æ¥æ“ä½œæ•°æ®ï¼Œä¾‹å¦‚get(), set(), has(), delete(), clear()ï¼Œä»¥åŠå¯ä»¥ç›´æ¥è¿›è¡Œè¿­ä»£çš„æ–¹æ³•ï¼Œä¾‹å¦‚keys(), values(), å’Œ entries()ã€‚

7. JSONæ”¯æŒï¼š
å¯¹è±¡ï¼ˆObjectï¼‰å¯ä»¥ç›´æ¥è¢«è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²ï¼Œä½¿ç”¨JSON.stringify()ã€‚
Mapä¸æ”¯æŒç›´æ¥è½¬æ¢ä¸ºJSONï¼Œéœ€è¦å…ˆè½¬æ¢ä¸ºæ•°ç»„æˆ–è€…å…¶ä»–ç»“æ„ã€‚

åœ¨å®è·µä¸­ï¼š
å¦‚æœä½ éœ€è¦ä¿è¯é”®çš„é¡ºåºï¼Œæˆ–è€…ä½ çš„é”®ä¸ä»…ä»…æ˜¯å­—ç¬¦ä¸²æˆ–Symbolï¼Œé‚£ä¹ˆMapå¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚
å¦‚æœä½ çš„æ•°æ®ç»“æ„ç›¸å¯¹ç®€å•ï¼Œå¹¶ä¸”ä¸»è¦ç”¨äºJSONåºåˆ—åŒ–ï¼Œé‚£ä¹ˆå¯¹è±¡å¯èƒ½æ›´ä¾¿æ·ã€‚

```



### WeakMap

> - `WeakMap`æ˜¯ä¸ºäº†**è§£å†³é¢‘ç¹å˜åŠ¨å¯¹è±¡åƒåœ¾å›æ”¶ï¼ˆGCï¼‰**è€Œå¼•å…¥çš„Mapå¼±å¼•ç”¨æ•°æ®ç»“æ„ã€‚
>
> - `WeakMap`åªæ¥å—å¯¹è±¡ä½œä¸ºé”®å(null é™¤å¤–)ã€‚å½“å¯¹è±¡åªè¢«`WeakMap`å¼•ç”¨åˆ°è€Œæ²¡è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨æ—¶ï¼Œåˆ™ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶å¹¶é‡Šæ”¾å†…å­˜ï¼Œç›¸åº”çš„`WeakMap`è¿™ä¸€é”®å€¼å¯¹ä¼šè¢«åˆ é™¤ã€‚
>
>   - å³æŠŠé”®é‡å®šä¹‰ä¸º`null`ï¼Œä¼šæ¸…é™¤ä¹‹å‰é”®çš„å¼•ç”¨ï¼Œå¯ä»¥é‡Šæ”¾è¯¥å‡ºçš„å†…å­˜ï¼›
>     æŠŠå€¼å®šä¹‰ä¸º`null`ï¼Œåªæ˜¯æ¸…é™¤å€¼çš„å¼•ç”¨ï¼Œè€Œé”®è¿˜åœ¨ï¼Œæ‰€ä»¥ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚
>
> - é”®åæ˜¯å¼±å¼•ç”¨ï¼Œé”®å€¼å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œé”®åæ‰€æŒ‡å‘çš„å¯¹è±¡å¯ä»¥è¢«åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶é”®åæ˜¯æ— æ•ˆçš„
>
> - ä¸èƒ½éå†ï¼Œæ–¹æ³•æœ‰ getã€setã€hasã€delete
>
> - ï¼ˆWeakMapçš„ç‰¹ç‚¹å¾ˆé€‚åˆç»™DOMå¯¹è±¡å…³è”ä¸€äº›ä¿¡æ¯å­˜å‚¨åœ¨`WeakMap`ä¸­ï¼ŒDOMå¯¹è±¡ä¸€æ—¦è¢«åˆ é™¤ï¼Œåˆ™å…¶å†…å­˜ä¼šè¢«å›æ”¶ï¼ŒWeakMapçš„è¿™ä¸€é”®å€¼å¯¹ä¼šæ¶ˆå¤±ï¼‰
>
>   ```js
>   var m = new WeakMap();
>   var x = { id: 1 }, y = { id: 2 }, z = { id: 3 }, w = { id: 4 };
>   m.set(x, y);
>   m.set(z, w);
>   x = null; // {id: 1}ä¸å†ç”±å˜é‡xå¼•ç”¨ï¼Œåªæœ‰mæ‰èƒ½å¼•ç”¨ï¼Œæ­¤æ—¶ï¼Œ{id: 1}ä¼šè¢«åƒåœ¾å›æ”¶ï¼Œè¿™ä¸€é”®å€¼å¯¹ä¼šè¢«åˆ é™¤ï¼›
>   w = null; // å°½ç®¡å€¼{id: 4}ä¹Ÿä¸å†ç”±wå¼•ç”¨ï¼Œä½†må¯¹å€¼çš„å¼•ç”¨æ˜¯å¼ºå¼•ç”¨ï¼Œæ‰€ä»¥{id: 4}ä¸ä¼šè¢«å›æ”¶
>   ```
>
>   ```js
>   /**
>    * ä½¿ç”¨DOMèŠ‚ç‚¹ä½œä¸ºé”®å
>    * æ¯å½“å‘ç”Ÿclickï¼Œå°±æ›´æ–°çŠ¶æ€ï¼Œå¹¶æŠŠè¿™ä¸ªçŠ¶æ€ä½œä¸ºé”®å€¼æ”¾åœ¨WeakMapï¼Œå¯¹åº”é”®åå°±æ˜¯è¿™ä¸ªèŠ‚ç‚¹å¯¹è±¡
>    * ä¸€æ—¦è¿™ä¸ªDOMèŠ‚ç‚¹åˆ é™¤ï¼Œè¯¥çŠ¶æ€å°±ä¼šæ¶ˆå¤±ï¼Œä¸å­˜åœ¨å†…å­˜æ³„æ¼é£é™©
>    */
>   let weakMap = new WeakMap();
>   weakMap.set(
>     document.getElementById('logo'),
>     { timesClicked: 0 }
>   );
>   document.getElementById('logo').addEventListener('click', function () {
>     let logoData = weakMap.get(document.getElementById('logo'));
>     logoData.timesClicked++;
>   }, false);
>   
>   
>   /**
>    * ä½¿ç”¨WeakMap éƒ¨ç½²ç§æœ‰å±æ€§
>    */
>   const _counter = new WeakMap();
>   const _action = new WeakMap();
>   
>   class Countdown {
>     constructor(counter, action) {
>       _counter.set(this, counter);
>       _action.set(this, action);
>     }
>     dec() {
>       let counter = _counter.get(this);
>       if (counter < 1) return;
>       counter--;
>       _counter.set(this, counter);
>       if (counter === 0) {
>         _action.get(this)();	// å½“counterä¸º0æ—¶ï¼Œåˆ™æ‰§è¡Œactionå‡½æ•°
>       }
>     }
>   }
>   
>   const c = new Countdown(2, () => console.log("DONE"));
>   c.dec();
>   c.dec();
>   // DONE
>   ```
>

### WeakRef

> - WeakRefå¯¹è±¡ç”¨äºç›´æ¥åˆ›å»ºå¯¹è±¡çš„å¼±å¼•ç”¨ï¼ŒåŸºäºåŸå§‹å¯¹è±¡åˆ›å»ºçš„WeakRefå®ä¾‹ä¸ä¼šå¦¨ç¢åŸå§‹å¯¹è±¡è¢«åƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤
> - `wr.deref()`æ–¹æ³•å¯åˆ¤æ–­åŸå§‹å¯¹è±¡æ˜¯å¦å·²è¢«åƒåœ¾å›æ”¶æ¸…é™¤
> - å¼±å¼•ç”¨å¯¹è±¡çš„ç”¨å¤„æ˜¯ï¼šä½œä¸ºç¼“å­˜ï¼Œæœªè¢«æ¸…é™¤æ—¶å¯ä»¥ä»ç¼“å­˜ä¸­å–å€¼ï¼Œä¸€æ—¦æ¸…é™¤ç¼“å­˜å°±è‡ªåŠ¨å¤±æ•ˆ
> - æ³¨æ„ï¼šä¸€æ—¦ä½¿ç”¨`WeakRef()`åˆ›å»ºäº†åŸå§‹å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œåˆ™åœ¨æœ¬è½®äº‹ä»¶å¾ªç¯`event loop`ä¸­ï¼ŒåŸå§‹å¯¹è±¡è‚¯å®šä¸ä¼šè¢«æ¸…é™¤ï¼Œåªä¼šåœ¨åé¢çš„äº‹ä»¶å¾ªç¯æ‰ä¼šè¢«æ¸…é™¤
>
> ```js
> /**
>  * targetæ˜¯åŸå§‹å°è±¡
>  * æ„é€ å‡½æ•° WeakRef() åˆ›å»ºäº†ä¸€ä¸ªåŸºäº targetçš„æ–°å¯¹è±¡wr
>  * wrå±äºå¯¹targetçš„å¼±å¼•ç”¨ï¼Œä¸ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶è®¡å…¥è¿™ä¸ªå¼•ç”¨
>  * å³wrçš„å¼•ç”¨ä¸ä¼šå¦¨ç¢åŸå§‹å¯¹è±¡targetè¢«åƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤
> */
> let targe = {};
> let wr = new WeakRef(target); // wr å’Œ target æ˜¯ä¸ä¸€æ ·çš„
> let obj = wr.deref();
> if(obj) { // target æœªè¢«åƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤
>   /* .... */
> }
> 
> 
> /**
>  * @ makeWeakCached() ç”¨äºå»ºç«‹ä¸€ä¸ªç¼“å­˜ï¼Œç¼“å­˜é‡Œé¢ä¿å­˜å¯¹åŸå§‹æ–‡ä»¶çš„å¼±å¼•ç”¨
>  */
> function makeWeakCached(files) {
>   const cache = new Map();
>   return key => {
>     const ref = cache.get(key);
>     if (ref) {
>       const cached = ref.deref();
>       if (cached !== undefined) return cached;
>     }
> 
>     const fresh = files(key);
>     cache.set(key, new WeakMap(fresh));
>     return fresh;
>   }
> }
> const getImageCached = makeWeakCached(getImage);
> ```

### FinalizationRegistry

> - æ¸…ç†å™¨æ³¨å†Œè¡¨åŠŸèƒ½`FinalizationRegistry`ç”¨æ¥æŒ‡å®šç›®æ ‡å¯¹è±¡è¢«åƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤åï¼Œæ‰€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°
> - æ³¨æ„ï¼šæ³¨å†Œè¡¨ä¸å¯¹ç›®æ ‡å¯¹è±¡æ„æˆå¼ºå¼•ç”¨ï¼Œå±äºå¼±å¼•ç”¨ã€‚å› ä¸ºå¼ºå¼•ç”¨çš„è¯ï¼ŒåŸå§‹å¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤ï¼Œè¿™å°±å¤±å»ä½¿ç”¨æ³¨å†Œè¡¨çš„æ„ä¹‰
> - å›è°ƒå‡½æ•°çš„å‚æ•°`heldValue`å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å€¼ï¼Œå­—ç¬¦ä¸²ã€æ•°å€¼ã€å¸ƒå°”å€¼ã€å¯¹è±¡ï¼Œç”šè‡³å¯ä»¥æ˜¯`undefined`
> - è‹¥æƒ³å–æ¶ˆå·²ç»æ³¨å†Œçš„å›è°ƒå‡½æ•°ï¼Œåˆ™è¦å‘`register()`ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä½œä¸ºæ ‡è®°å€¼ï¼Œè¿™ä¸ªæ ‡è®°å€¼å¿…é¡»æ˜¯å¯¹è±¡ï¼Œä¸€èˆ¬éƒ½ç”¨åŸå§‹å¯¹è±¡ã€‚ç„¶åå†ä½¿ç”¨æ³¨å†Œè¡¨å®ä¾‹å¯¹è±¡çš„`unregister()`æ–¹æ³•å–æ¶ˆæ³¨å†Œã€‚
>   - ç¬¬ä¸‰ä¸ªå‚æ•°ä¹Ÿå±äºå¼±å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªå‚æ•°ï¼Œåˆ™å›è°ƒå‡½æ•°æ— æ³•å–æ¶ˆ
>   - ç”±äºå›è°ƒå‡½æ•°è¢«è°ƒç”¨ä»¥åå°±ä¸å†å­˜åœ¨äºæ³¨å†Œè¡¨ä¹‹ä¸­ï¼Œæ‰€ä»¥æ‰§è¡Œ`unregister()`åº”è¯¥æ˜¯åœ¨å›è°ƒå‡½æ•°è¿˜æ²¡è¢«è°ƒç”¨ä¹‹å‰ã€‚
>
> ```js
> /**
>  * æ–°å»ºä¸€ä¸ªæ³¨å†Œè¡¨å®ä¾‹
>  * @FinalizationRegistry æ˜¯ç³»ç»Ÿæä¾›çš„æ„é€ å‡½æ•°ï¼›
>  * @callBack å›è°ƒå‡½æ•°ä½œä¸ºè¯¥æ„é€ å‡½æ•°å‚æ•°ä¼ å…¥ï¼Œå®ƒæœ¬èº«æœ‰ä¸€ä¸ªå‚æ•° heldValue
>  * @return è¿”å›ä¸€ä¸ªæ¸…ç†å™¨æ³¨å†Œè¡¨å®ä¾‹ï¼Œé‡Œé¢ç™»è®°äº†ç´¢è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°
> */
> const registry = new FinalizationRegistry(heldValue => {
>   // ....
> });
> 
> /**
>  * @registry æ³¨å†Œè¡¨å®ä¾‹çš„registry æ–¹æ³•ï¼Œæ¥ç”¨æ³¨å†Œç´¢è¦è§‚å¯Ÿçš„ç›®æ ‡å¯¹è±¡
>  * theObjectæ˜¯ç´¢è¦è§‚å¯Ÿçš„ç›®æ ‡å¯¹è±¡ï¼Œä¸€æ—¦è¯¥å¯¹è±¡è¢«åƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤ï¼Œæ³¨å†Œè¡¨å°±ä¼šåœ¨æ¸…é™¤å®Œæˆåï¼Œè°ƒç”¨æ—©å‰æ³¨å†Œè¡¨çš„å›è°ƒå‡½æ•°ï¼Œå¹¶å°†`some value`ä½œä¸ºå‚æ•°ä¼ å…¥å›è°ƒå‡½æ•°
> */
> registry.register(theObject, "some value");
> 
> // ç¬¬ä¸‰ä¸ªå‚æ•°ç”¨äºå–æ¶ˆå·²æ³¨å†Œçš„å›è°ƒå‡½æ•°
> registry.register(theObject, "some value", theObject);
> // ...å…¶ä»–æ“ä½œ
> 
> // ...è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœä½ ä¸å†å…³å¿ƒ theObject
> registry.unregister(theObject);
> ```
>
> #### ã€å…¸ä¾‹ã€‘ç¼“å­˜å‡½æ•°
>
> ```js
> /**
>  * ç¼“å­˜å‡½æ•°
>  * å¢åŠ ä¸€ä¸ªæ¸…ç†å™¨æ³¨å†Œè¡¨ï¼Œä¸€æ—¦ç¼“å­˜çš„åŸå§‹å¯¹è±¡è¢«åƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œä¸€ä¸ªå›è°ƒå‡½æ•°
>  * è¯¥å›è°ƒå‡½æ•°ä¼šæ¸…é™¤ç¼“å­˜é‡Œé¢å·²ç»å¤±æ•ˆçš„é”®
> */
> function makeWeakCached(files) {
>   const cache = new Map();
>   const cleanup = new FinalizationRegistry(key => {
>     const ref = cache.get(key);
>     if (ref && !ref.deref()) cached.delete(key);
>   });
> 
>   return key => {
>     const ref = cache.get(key);
>     if (ref) {
>       const cached = ref.deref();
>       if (cached !== undefined) return cached;
>     }
> 
>     const fresh = files(key);
>     cache.set(key, new WeakMap(fresh));
>     cleanup.register(fresh, key);
>     return fresh;
>   }
> }
> 
> const getImageCached = makeWeakCached(getImage);
> ```

## é«˜é˜¶å‡½æ•°

- é«˜é˜¶å‡½æ•°æ˜¯å¯¹å…¶ä»–å‡½æ•°è¿›è¡Œæ“ä½œçš„å‡½æ•°ï¼Œå®ƒæ¥å—å‡½æ•°ä½œä¸ºå‚æ•°æˆ–å°†å‡½æ•°ä½œä¸ºè¿”å›å€¼è¾“å‡ºã€‚
- å‡½æ•°ä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œå¯ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‚æ•°ä½¿ç”¨ã€‚å¦‚ï¼šå›è°ƒå‡½æ•°ã€‚

```html
<div style="width: 200px;height: 200px;position: absolute;background-color: pink;"></div>

<script src="../lib/jquery-3.2.1.js"></script>
<script>
function fn(a, b, callback) {
    console.log(a + b);
    callback && callback();
}
fn(1, 2, function() {
    console.log("æˆ‘æ˜¯æœ€åè°ƒç”¨çš„");
});
$("div").animate({left: 500}, function(){
    $("div").css("background","purple");
})
```

### `generator`ç”Ÿæˆå™¨

- generator ç”Ÿæˆå™¨æ˜¯ES6å¼•å…¥çš„æ–°æ•°æ®ç±»å‹ï¼Œ**å¯è¿”å›å¤šæ¬¡å€¼**ã€‚
- generator ä¸ä¸€èˆ¬å‡½æ•°çš„åŒºåˆ«
  - ä¸€èˆ¬å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ²¡æœ‰é‡åˆ°`return `è¯­å¥(å‡½æ•°æœ«å°¾å¦‚æœæ²¡æœ‰`return`ï¼Œé»˜è®¤ä¸º`return undefined;`)ï¼Œæ§åˆ¶æƒæ— æ³•è¿”å›è¢«è°ƒç”¨çš„ä»£ç ã€‚
  - generatorä¸ä¸€èˆ¬å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œgeneratorç”±`function*`å®šä¹‰ï¼Œå¹¶ä¸”é™¤äº†`return`è¯­å¥ï¼Œè¿˜å¯ç”¨`yield`è¿”å›å¤šæ¬¡ã€‚
- `yield*`è¡¨è¾¾å¼ç”¨äºå§”æ‰˜ç»™å¦ä¸€ä¸ªgeneratoræˆ–å¯è¿­ä»£å¯¹è±¡ã€‚å…¶è¡¨è¾¾å¼æœ¬èº«çš„å€¼æ˜¯å½“è¿­ä»£å™¨å…³é—­æ—¶è¿”å›å€¼(å³doneä¸ºtrueæ—¶)
- è°ƒç”¨ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°å¹¶ä¸ä¼šé©¬ä¸Šæ‰§è¡Œå®ƒé‡Œé¢çš„è¯­å¥ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªè¿™ä¸ªç”Ÿæˆå™¨çš„è¿­ä»£å™¨å¯¹è±¡ï¼Œå½“è¿™ä¸ªè¿­ä»£å™¨çš„`next()` æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå…¶å†…çš„è¯­å¥ä¼šæ‰§è¡Œåˆ°å‡ºç° `yield` çš„ä½ç½®ä¸ºæ­¢ï¼ˆè®©æ‰§è¡Œå¤„äº**æš‚åœçŠ¶æ€**ï¼‰ï¼Œ`yield` åç´§è·Ÿè¿­ä»£å™¨è¦è¿”å›çš„å€¼ã€‚æˆ–è€…å¦‚æœç”¨çš„æ˜¯ `yield*`ï¼Œåˆ™è¡¨ç¤ºå°†æ‰§è¡Œæƒç§»äº¤ç»™å¦ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼ˆå½“å‰ç”Ÿæˆå™¨**æš‚åœæ‰§è¡Œ**ï¼‰ï¼Œè°ƒç”¨ `next()`æ–¹æ³•æ—¶å¦‚æœä¼ å…¥å‚æ•°ï¼Œåˆ™æ­¤å‚æ•°ä¼šä½œä¸º**ä¸Šä¸€æ¡æ‰§è¡Œçš„ `yield` è¯­å¥çš„è¿”å›å€¼**
- è°ƒç”¨ generator å¯¹è±¡ç”±ä¸¤ä¸ªæ–¹æ³•ï¼š
  1. ä¸æ–­åœ°è°ƒç”¨generatorå¯¹è±¡çš„`next()`æ–¹æ³•ã€‚
     `next()`æ–¹æ³•ä¼šæ‰§è¡Œgeneratorçš„ä»£ç ï¼Œç„¶åæ¯æ¬¡é‡åˆ°`yield x;`å°±è¿”å›ä¸€ä¸ªå¯¹è±¡`{value:x, done:true/false}`ï¼Œç„¶åâ€œæš‚åœâ€ã€‚è¿”å›çš„`value`å°±æ˜¯`yield`çš„è¿”å›å€¼ï¼Œ`done`è¡¨ç¤ºè¿™ä¸ªgeneratoræ˜¯å¦å·²ç»æ‰§è¡Œç»“æŸï¼›å¦‚æœ`done`ä¸º`true`ï¼Œåˆ™`value`å°±æ˜¯`return`çš„è¿”å›å€¼ã€‚
  2. ç”¨`for...of`å¾ªç¯è¿­ä»£ generator å¯¹è±¡ï¼Œè¿™ç§æ–¹å¼ä¸éœ€è¦åˆ¤æ–­`done`
- generatoråº”ç”¨åœºæ™¯
  1. æ¯æ¬¡è¿”å›ä¸€ä¸ªå€¼ï¼šåœ¨åŒä¸€åœºåˆä¸‹ï¼Œå‡½æ•°åªèƒ½è¿”å›ä¸€æ¬¡ï¼Œæ‰€ä»¥å¿…é¡»è¿”å›ä¸€ä¸ª`Array`ï¼›ä½†æ˜¯æ¢æˆgeneratorï¼Œå°±**å¯ä»¥ä¸€æ¬¡è¿”å›ä¸€ä¸ªæ•°ï¼Œä¸æ–­è¿”å›å¤šæ¬¡**ã€‚
  2. ç”¨ä¸€ä¸ªå¯¹è±¡æ¥ä¿å­˜çŠ¶æ€ï¼šå› ä¸ºgeneratorå¯ä»¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¤šæ¬¡è¿”å›ï¼Œæ‰€ä»¥å®ƒå°±åƒä¸€ä¸ªå¯è®°ä½æ‰§è¡ŒçŠ¶æ€çš„å‡½æ•°ã€‚
  3. å¯æŠŠajaxçš„å¼‚æ­¥å›è°ƒå˜æˆåŒæ­¥å¼ajaxï¼Œç›¸å¯¹ä¼ ç»Ÿçš„ thenå¼ï¼Œä¼˜åŒ–äº†å›è°ƒåœ°ç‹±

```js
function* another() {
  yield 'willy';
}
function* gen() {
  yield* another();
  const a = yield 'hello';
  const b = yield a + 1;
  yield b;
  return "return"
}
const g = gen();
let
  a = g.next().value, // another()ä¸­è¿”å›çš„å€¼
  b = g.next().value, // 
  c = g.next('world').value, // æŠŠè¯­å¥ yield a+1 ä¸­çš„å€¼
  d = g.next('!').value,  // æŠŠè¯­å¥ yield b ä¸­çš„å€¼æ›¿æ¢ä¸º ! 
  e = g.next().value, // returnè¿”å›çš„å€¼
  f = g.next().value; // è¶…å‡ºç•Œé™
console.log([a, b, c, d, e, f]);  // [ 'willy', 'hello', 'world1', '!', 'return', undefined ]
```

```js
/* æ™®é€šå‡½æ•° */
function fib(max) {
  let a = 0, b = 1, arr = [0, 1,];
  while (arr.length < max) {
    [a, b] = [b, a + b];
    arr.push(b);
  }
  return arr;
}
console.log(fib(5));    // [ 0, 1, 1, 2, 3 ]

/* ç”Ÿæˆå™¨ */
function* fibGenerator(max) {
  let a = 0, b = 1, n = 0;
  while (n < max) {
    yield a;
    [a, b] = [b, a + b];
    n++;
  }
  return 'æœ€åreturnçš„å€¼';
}
// next()æ–¹æ³•å¾ªç¯è¿­ä»£generator
let f = fibGenerator(5);
let f1 = f.next().value, f2 = f.next().value, f3 = f.next().value;
let f4 = f.next().value, f5 = f.next().value, f6 = f.next().value;
console.log("next()", [f1, f2, f3, f4, f5, f6]); // next() [ 0, 1, 1, 2, 3, 'æœ€åreturnçš„å€¼' ]

// for...of å¾ªç¯è¿­ä»£generator
let ff = fibGenerator(5), ffResult = [];
for (let x of ff) {
  // console.log(x);
  ffResult = [...ffResult, x];
}
console.log("for...ofï¼š", ffResult);  // for...ofï¼š [ 0, 1, 1, 2, 3 ]


// while å¾ªç¯è¿­ä»£generator
let fff = fibGenerator(5);
let res = fff.next(), result = [];
while (!res.done) {
  result = [...result, res.value];
  res = fff.next();
}
console.log("while", result);  // while [ 0, 1, 1, 2, 3 ]


// ç”¨generator ç”ŸæˆåŒæ­¥å¼ajaxï¼Œç›¸å¯¹ä¼ ç»Ÿçš„ thenï¼Œä¼˜åŒ–äº†å›è°ƒåœ°ç‹±
/* try {
  r1 = yield ajax('http://url-1', data1);
  r2 = yield ajax('http://url-2', data2);
  r3 = yield ajax('http://url-3', data3);
  success(r3);
} catch (err) {
  handle(err);
} */

```

### `Iterator`è¿­ä»£å™¨

- `Stringã€Arrayã€TypeArrayã€Mapã€Set`éƒ½æ˜¯å†…ç½®å¯è¿­ä»£å¯¹è±¡ï¼Œå› ä¸ºå®ƒä»¬åŸå‹å¯¹è±¡éƒ½æ‹¥æœ‰`Symbol.iterator`æ–¹æ³•ã€‚
- ç”¨äºå¯è¿­ä»£å¯¹è±¡çš„è¯­æ³•ï¼š`for..of`å¾ªç¯ã€å±•å¼€è¯­æ³•(ä¸‰ç‚¹)ã€`yield*(ç”Ÿæˆå™¨çš„yieldå¤šæ¬¡è¿”å›å€¼)`å’Œè§£æ„å¯¹è±¡ã€‚

```js
/* Array */
let arr = ['a', 'b', 'c'];
let arr1 = arr[Symbol.iterator]();
console.log(arr1.next().value, arr1.next().value, arr1.next().value, arr1.next().value);

/* Mapæ•°æ®æœºæ„ */
const map = new Map();
map.set('a', 'willy');
map.set('c', 'cilly');


// é€šè¿‡ for...of å¾ªç¯è¿­ä»£
const iterator1 = map[Symbol.iterator]();
for (let item of iterator1) {
    console.log("for..ofå¾ªç¯è¿­ä»£ï¼š" + item);
}

// é€šè¿‡å±•å¼€è¯­æ³• ä¸‰ç‚¹è¿ç®—ç¬¦ æ¥è¿­ä»£
const iterator2 = map[Symbol.iterator]();
console.log(...iterator2);

// é€šè¿‡ç”Ÿæˆå™¨ yield* å¤šæ¬¡è¿”å›æ¥è¿­ä»£
const iterator3 = map[Symbol.iterator]();
function* gen() {
    yield* iterator3;
}
console.log(gen().next(), gen().next(), gen().next());

/* æ§åˆ¶å°è¾“å‡º
a b c undefined
for..ofå¾ªç¯è¿­ä»£ï¼ša,willy
for..ofå¾ªç¯è¿­ä»£ï¼šc,cilly
[ 'a', 'willy' ] [ 'c', 'cilly' ]
{ value: [ 'a', 'willy' ], done: false } { value: [ 'c', 'cilly' ], done: false } { value: undefined, done: true } */
```

## è±¡å¾å±æ€§ Symbol

```bash
## è±¡å¾å±æ€§ Symbol
åªæœ‰ä¸¤ç§åŸå§‹ç±»å‹å¯ä»¥ç”¨ä½œå¯¹è±¡å±æ€§é”®ï¼š
	1. å­—ç¬¦ä¸²ç±»å‹ï¼ˆæ•°å­—ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼‰
	2. Symbol ç±»å‹


- symbol æ˜¯ä¸€ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œ`Symbol()` å‡½æ•°ä¼šè¿”å› symbol ç±»å‹çš„å€¼ï¼Œè¯¥ç±»å‹å…·æœ‰é™æ€å±æ€§å’Œé™æ€æ–¹æ³•ã€‚
    - å®ƒçš„é™æ€å±æ€§ä¼šæš´éœ²å‡ ä¸ªå†…å»ºçš„æˆå‘˜å¯¹è±¡ã€‚
    - å®ƒçš„é™æ€æ–¹æ³•ä¼šä¿æŠ¤å…¨å±€çš„ symbol æ³¨å†Œï¼Œä¸”ç±»ä¼¼å†…å»ºå¯¹è±¡ç±»ï¼Œä½†å› ä¸ºä¸æ”¯æŒ `new Symbol()`ï¼Œæ‰€ä»¥ä½œä¸ºæ„é€ å‡½æ•°å®ƒå¹¶ä¸å®Œæ•´ã€‚
- æ¯ä¸ªä» `Symbol()` è¿”å›çš„ symbol å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚å³ä½¿åˆ›å»ºè®¸å¤šå…·æœ‰ç›¸åŒæè¿°çš„ symbolï¼Œå®ƒä»¬çš„å€¼ä¹Ÿæ˜¯ä¸åŒã€‚æè¿°åªæ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼Œä¸å½±å“ä»»ä½•ä¸œè¥¿ã€‚
- ä¸€ä¸ª symbol å€¼èƒ½è¡¨ç¤ºå¯¹è±¡å±æ€§çš„æ ‡è¯†ç¬¦ (è¯¥æ•°æ®ç±»å‹ä»…æœ‰çš„ç›®çš„)ã€‚


### symbol çš„ç‰¹ç‚¹
  - Symbolå±æ€§å€¼å”¯ä¸€ï¼Œé¿å…äº†å¸¸é‡å€¼é‡å¤é—®é¢˜
  - Symbolä¸èƒ½ä¸å…¶ä»–ç±»å‹çš„å€¼è¿›è¡Œè¿ç®—
  - Symbolå¯ä»¥è½¬æ¢ä¸ºå­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼Œä½†ä¸èƒ½è½¬ä¸ºæ•°å­—
  - for inã€for of éå†æ—¶ä¸ä¼šéå†Symbolå±æ€§ã€‚
æ³¨æ„ï¼šSymbolæ˜¯å‡½æ•°ï¼Œä½†å¹¶ä¸æ˜¯æ„é€ å‡½æ•°


### symbol ä¸ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²
JS ä¸­çš„å¤§å¤šæ•°å€¼éƒ½æ”¯æŒå­—ç¬¦ä¸²çš„éšå¼è½¬æ¢ï¼Œä½† symbol ä¸ä¼šè¢«è‡ªåŠ¨è½¬æ¢ã€‚
è¿™æ˜¯ä¸€ç§é˜²æ­¢æ··ä¹±çš„â€œè¯­è¨€ä¿æŠ¤â€ï¼Œå› ä¸ºå­—ç¬¦ä¸²å’Œ symbol æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼Œä¸åº”è¯¥æ„å¤–åœ°å°†å®ƒä»¬è½¬æ¢æˆå¦ä¸€ä¸ªã€‚
æ˜¾ç¤ºä¸€ä¸ª symbol å€¼çš„æ–¹æ³•ï¼š
	1. é€šè¿‡ `Symbol('symbolå®šä¹‰çš„å€¼').toString()` è½¬æ¢ã€‚
	2. é€šè¿‡è·å– `symbol.desciption` å±æ€§ï¼Œåªæ˜¾ç¤ºæè¿°ã€‚

```


```js
let s1 = Symbol('foo');
let s2 = Symbol('foo');
console.log(s1 == s2); // false
console.log(s1.toString() == s2.toString());  // true
```

#### éšè—å±æ€§

> symbol å…è®¸åˆ›å»ºå¯¹è±¡çš„éšè—å±æ€§ï¼Œä»£ç çš„ä»»ä½•å…¶ä»–éƒ¨åˆ†éƒ½ä¸èƒ½æ„å¤–è®¿é—®æˆ–é‡å†™è¿™äº›å±æ€§ã€‚
>
> ```js
> // å±äºå¦ä¸€ä¸ªä»£ç åº“
> const user = {name: 'Willy'}
> 
> // æ·»åŠ æ ‡è¯†ç¬¦
> const flag = Symbol('flag')
> user[flag] = 'Their flag value'
> 
> // å®šä¹‰å˜é‡
> const id = Symbol('id')
> user[id] = 1
> 
> console.log(user[id]) // å¯ä»¥ä½¿ç”¨ symbol ä½œä¸ºé”®æ¥è®¿é—®æ•°æ®
> 
> ```
>
> åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œç”±äº `user` å¯¹è±¡å±äºå¦ä¸€ä¸ªä»£ç åº“ï¼Œæ‰€ä»¥å‘å®ƒæ·»åŠ å­—æ®µæ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½ä¼šå½±å“ä»£ç åº“ä¸­çš„å…¶ä»–é¢„å®šä¹‰è¡Œä¸ºã€‚ä½† symbol å±æ€§ä¸ä¼šè¢«æ„å¤–è®¿é—®åˆ°ã€‚ç¬¬ä¸‰æ–¹ä»£ç ä¸ä¼šçŸ¥é“æ–°å®šä¹‰çš„ symbolï¼Œå› æ­¤å°† symbol æ·»åŠ åˆ° `user` å¯¹è±¡æ˜¯å®‰å…¨çš„ã€‚
>
> å¦å¤–ï¼Œå‡è®¾å¦ä¸€ä¸ªè„šæœ¬å¸Œæœ›åœ¨ `user` ä¸­æœ‰è‡ªå·±çš„æ ‡è¯†ç¬¦ï¼Œä»¥å®ç°è‡ªå·±çš„ç›®çš„ã€‚
>
> - ä½¿ç”¨ symbol ä½œä¸ºæ ‡è¯†ç¬¦ï¼Œæ ‡è¯†ç¬¦ä¸æ ‡è¯†ç¬¦ä¹‹å‰ä¸ä¼šå†²çªï¼Œå› ä¸º symbol æ€»æ˜¯ä¸åŒçš„ï¼Œå³ä½¿å®ƒä»¬æœ‰ç›¸åŒçš„åå­—ã€‚
> - ä½†å¦‚æœä½¿ç”¨å­—ç¬¦ä¸²`flag`è€Œä¸æ˜¯ç”¨ symbolï¼Œå°±ä¼šå‡ºç°å†²çªï¼Œåè€…ä¼šè¦†ç›–å‰è€…çš„å†…å®¹ã€‚

#### é¿å…å€¼é‡å¤

```js
const KEY = {
  alibaba: Symbol(),
  baidu: Symbol(),
  tencent: Symbol()
}
function getValue(key) {
  switch (key) {
    case KEY.alibaba:
      console.log('alibaba')
    case KEY.baidu:
      console.log('baidu')
    case KYEY.tencent:
      console.log('tencent')
  }
}
getValue(KEY.baidu);
```

#### å®ä¾‹ï¼šæ¶ˆé™¤é­”æœ¯å­—ç¬¦ä¸²

é­”æœ¯å­—ç¬¦ä¸²æ˜¯æŒ‡åœ¨ä»£ç ä¸­å¤šæ¬¡å‡ºç°ï¼Œä¸ä»£ç å½¢æˆå¼ºè€¦åˆçš„æŸä¸€å­—ç¬¦ä¸²æˆ–æ•°å€¼ï¼Œä¸åˆ©äºå°†æ¥çš„ä¿®æ”¹å’Œç»´æŠ¤ã€‚
æ¶ˆé™¤é­”æœ¯å­—ç¬¦ä¸² å¸¸ç”¨çš„æ˜¯æ–¹æ³•æ˜¯æŠŠä»–**è®¾ç½®ä¸ºä¸€ä¸ªå˜é‡**ã€‚

```js
const evening = Symbol('æ˜ŸæœŸä¸€');	// ç»™å¸¸ç”¨çš„å­—ç¬¦ä¸² å®šä¹‰ä¸ºå˜é‡
function getEating(today, option) {
  let food = "tomato";
  switch (today) {
    case evening:
      food = option;
      break;
  }
  return food;
}
console.log(getEating(evening, "noodles"));
```

#### å¯è¿­ä»£å¯¹è±¡

- æ‹¥æœ‰`Symbol.iterator`å‡½æ•°çš„å¯¹è±¡è¢«ç§°ä¸ºå¯è¿­ä»£å¯¹è±¡ï¼Œå³å¯ä»¥åœ¨å¯¹è±¡ä¸­ä½¿ç”¨`for..of`å¾ªç¯
- `symbol`è®©å¯¹è±¡çš„å†…éƒ¨æ•°æ®å’Œç”¨æˆ·æ•°æ®éš”ç¦»ã€‚ç”±äº`sysmbol`æ— æ³•åœ¨ JSON é‡Œè¡¨ç¤ºï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒç»™ Express API ä¼ å…¥å¸¦æœ‰ä¸åˆé€‚çš„`Symbol.iterator`å±æ€§çš„æ•°æ®ã€‚å¦å¤–ï¼Œå¯¹äºé‚£ç§æ··åˆäº†å†…ç½®å‡½æ•°å’Œç”¨æˆ·æ•°æ®çš„å¯¹è±¡ï¼Œå¯ä»¥ç”¨`symbol`æ¥ç¡®ä¿ç”¨æˆ·æ•°æ®ä¸ä¼šè·Ÿå†…ç½®å±æ€§å†²çªã€‚

```js
const fibonacci = {
  [Symbol.iterator]: function* () {
    let a = 1, b = 1;
    while (true) {
      [a, b] = [a+b, a]
      yield b;
    }
  }
};

// Prints every Fibonacci number less than 100
let a = [];
for (const x of fibonacci) {
  if (x >= 100) { break; }
  a = [...a, x];
}
console.log(a);
```

```js
class MyClass {
  constructor(obj) {
    Object.assign(this, obj);
  }

  iterator() {
    const keys = Object.keys(this);
    let i = 0;
    return (function* () {
      if (i >= keys.length) {
        return;
      }
      yield keys[i++];
    })();
  }
}
const obj = new MyClass({ iterator: 'not a function' });
console.log(obj.iterator());
```

- `MyClass` çš„å®ä¾‹æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œå¯ä»¥éå†å¯¹è±¡ä¸Šé¢çš„å±æ€§ã€‚ä½†æ˜¯ä¸Šé¢çš„ç±»æœ‰ä¸ªæ½œåœ¨çš„ç¼ºé™·ï¼Œå‡è®¾æœ‰ä¸ªæ¶æ„ç”¨æˆ·ç»™ `MyClass` æ„é€ å‡½æ•°ä¼ äº†ä¸€ä¸ªå¸¦æœ‰`iterator`å±æ€§çš„å¯¹è±¡ã€‚å½“åœ¨å®ä¾‹ä¸Šä½¿ç”¨`for/of`ä¼šæŠ›å‡º`TypeError: obj is not iterable`å¼‚å¸¸ã€‚å¯ä»¥çœ‹å‡ºä¼ å…¥å¯¹è±¡çš„ `iterator`å‡½æ•°è¦†ç›–äº†ç±»çš„ `iterator`å±æ€§ã€‚ä¼šäº§ç”Ÿç±»ä¼¼åŸå‹æ±¡æŸ“çš„å®‰å…¨é—®é¢˜ï¼Œæ— è„‘å¤åˆ¶ç”¨æˆ·æ•°æ®ä¼šå¯¹ä¸€äº›ç‰¹æ®Šå±æ€§ï¼Œæ¯”å¦‚`__proto__`å’Œ`constructor`å¸¦æ¥é—®é¢˜ã€‚

####  å¤ç”¨åŒä¸€ä¸ªSymbolå€¼ï¼šfor/keyFor

- **`Symbol.for(key)`** æ–¹æ³•ä¼šæ ¹æ®ç»™å®šçš„é”® `key`æ¥ä»è¿è¡Œæ—¶çš„ symbol æ³¨å†Œè¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„ symbolï¼Œå¦‚æœæ‰¾åˆ°åˆ™è¿”å›å®ƒï¼›å¦åˆ™ï¼Œæ–°å»ºä¸€ä¸ªä¸è¯¥é”®å…³è”çš„ symbolï¼Œå¹¶æ”¾å…¥å…¨å±€ symbol æ³¨å†Œè¡¨ä¸­ã€‚

- **`Symbol.keyFor(key)`**æ–¹æ³•è¿”å›ä¸€ä¸ªå·²ç™»è®°çš„ Symbol ç±»å‹å€¼çš„`key`ã€‚

- > æ³¨æ„ï¼šä¸ºäº†é˜²èŒƒå†²çªï¼Œæœ€å¥½ç»™è¦æ”¾å…¥ symbol æ³¨å†Œè¡¨ä¸­çš„ symbol å¸¦ä¸Šé”®å‰ç¼€ã€‚
  > forä¸keyforçš„åŒºåˆ«ï¼šå‰è€…ä¼šè¢«ç™»è®°åœ¨å…¨å±€ç¯å¢ƒä¸­ä¾›æœç´¢ï¼Œåè€…ä¸ä¼šã€‚

```js
let a = Symbol.for("foo"); // åˆ›å»ºä¸€ä¸ª symbol å¹¶æ”¾å…¥ symbol æ³¨å†Œè¡¨ä¸­ï¼Œé”®ä¸º "foo"
let b = Symbol.for("foo"); // ä» symbol æ³¨å†Œè¡¨ä¸­è¯»å–é”®ä¸º"foo"çš„ symbol
console.log(a == b);	// true
Symbol.for("mdn.foo");	// ç»™åŠ å…¥é”®å‰ç¼€ mdn.

Symbol.keyFor(s1) // "foo"
Symbol.keyFor(s2) // undefined
```



#### å®ä¾‹ï¼šæ¨¡å—çš„ Singleton æ¨¡å¼

Singletonæ¨¡å—æŒ‡çš„æ˜¯è°ƒç”¨ä¸€ä¸ªç±»ï¼Œä»»ä½•æ—¶å€™è¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚

```js
// a.js
const NAME_KEY = Symbol.for('name');	// å¦‚æœé”®åä½¿ç”¨Symbolæ–¹æ³•ç”Ÿæˆï¼Œé‚£ä¹ˆå¤–éƒ¨å°†æ— æ³•å¼•ç”¨è¿™ä¸ªå€¼ï¼Œå¯¼è‡´ä¹Ÿå°±æ— æ³•æ”¹å†™nameçš„å€¼ã€‚
function A() {
    this.name = "willy";
}
if(!global[NAME_KEY]) {
    global[NAME_KEY] = new A();
}
module.exports = global[NAME_KEY];


// b.js
global[Symbol.for('name')] = { name: 'xili' };	// è°ƒç”¨æ—¶ï¼Œæ›´æ”¹a.jsé‡Œé¢å®šä¹‰çš„nameå±æ€§
const a = require('./a.js');
console.log(a)	// { name: 'xili' }
```



#### Symbol.prototype.description

> å½“æˆ‘ä»¬åœ¨ JS ä¸­åˆ›å»ºä¸€ä¸ª `Symbol` æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªæè¿°ï¼Œç”¨äºä»¥åçš„è°ƒè¯•ã€‚å–å›è¿™ä¸ªæè¿°çš„è¿‡ç¨‹æœ‰ç‚¹ä¹å‘³ã€‚æˆ‘ä»¬å¿…é¡»é‡æ–°æ„é€  `Symbol`ï¼Œå¹¶å€ŸåŠ© `toString()` æ–¹æ³•è®¿é—®æè¿°ã€‚
>
> ES10 æ·»åŠ äº†ä¸€ä¸ªåä¸º `description` çš„æ–°åªè¯»å±æ€§ï¼Œè¯¥å±æ€§è¿”å› `Symbol` çš„æè¿°ã€‚
>
> ```js
> const symbol = Symbol('This is a Symbol')
> console.log(symbol.toString()) // Symbol(This is a Symbol)
> console.log(symbol.description) // This is a Symbol
> ```
>



## ä»£ç†å¯¹è±¡ Proxy

> ```bash
> ## ä»£ç†å¯¹è±¡ Proxy
> - `Proxy`ç”¨äºä¿®æ”¹æŸäº›æ“ä½œçš„é»˜è®¤è¡Œä¸ºï¼Œç­‰åŒäºåœ¨è¯­è¨€å±‚é‡Œé¢åšå‡ºä¿®æ”¹ï¼Œæ‰€ä»¥å±äºä¸€ç§â€œå…ƒç¼–ç¨‹â€ï¼Œå³å¯¹ç¼–ç¨‹è¯­è¨€è¿›è¡Œç¼–ç¨‹ã€‚
> - Proxyç»™ç›®æ ‡å¯¹è±¡è®¾ç½®ä¸€å±‚â€œæ‹¦æˆªâ€ï¼Œå¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®å¿…é¡»é€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œå¯å¯¹å¤–ç•Œçš„è®¿é—®è¿›è¡Œè¿‡æ»¤å’Œæ”¹å†™ç­‰è‡ªå®šä¹‰æ“ä½œï¼ˆä»£ç†å®Œæˆå¯¹æ•°æ®çš„å¤„ç†ã€å¯¹æ„é€ å‡½æ•°çš„å¤„ç†ï¼Œå¯¹æ•°æ®çš„éªŒè¯ï¼‰
> 
> 
> ## åå°„ Reflect
>   - `Reflect`æ˜¯ä¸€ä¸ªå†…ç½®å¯¹è±¡ï¼Œå®ƒæä¾›æ‹¦æˆª`JavaScript`æ“ä½œçš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ä¸`Proxy handlers`çš„æ–¹æ³•ç›¸åŒ
>   - `Reflect`ä¸æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œå› æ­¤å®ƒæ˜¯ä¸å¯æ„é€ çš„ï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡`new`æ¥å¯¹å…¶è¿›è¡Œè°ƒç”¨ï¼Œæˆ–ä½œä¸ºä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨ã€‚
>   - `Reflect`çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯é™æ€çš„
>   
>   
>   
>  let p = new Proxy(target, handler);
> 	- ä»£ç†å®ä¾‹ä¸­æ²¡æœ‰æŒ‡å®šçš„`handler`ï¼Œå®é™…å°±æ˜¯æ“ä½œåŸå¯¹è±¡`target`ã€‚
> 	- `target`ï¼šéœ€è¦ä½¿ç”¨`Proxy`åŒ…è£…çš„ç›®æ ‡å¯¹è±¡ï¼ˆå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬åŸç”Ÿæ•°ç»„ã€å‡½æ•°ã€ç”šè‡³æ˜¯å¦ä¸€ä¸ªä»£ç†ï¼‰
> 	- `handler`ï¼šä¸€ä¸ªå¯¹è±¡ï¼Œå…¶å±æ€§æ˜¯å½“æ‰§è¡Œä¸€ä¸ªæ“ä½œæ—¶å®šä¹‰ä»£ç†çš„è¡Œä¸ºå‡½æ•°ï¼ˆå¯ç†è§£ä¸ºæŸç§è§¦å‘å™¨ï¼‰  
> ```
>
> ```js
> /**
> 	* åŒä¸€æ‹¦æˆªå‡½æ•°ï¼Œè®¾ç½®æ‹¦æˆªå¤šä¸ªæ“ä½œ
> */
> var handler = {
>   get: function(target, propKey) {
>     if (propKey === 'prototype')  return Object.prototype;
>     if (propKey in target) return target[propKey];
>     throw new ReferenceError("Prop name \"" + propKey + "\" does not exist.");
>   },
> 
>   apply: function(target, thisBinding, args) {
>     return args[0];
>   },
> 
>   construct: function(target, args) {
>     return {value: args[1]};
>   }
> };
> 
> var fproxy = new Proxy(function(x, y) {
>   return x + y;
> }, handler);
> 
> fproxy(1, 2) // 1
> new fproxy(1, 2) // {value: 2}
> fproxy.prototype === Object.prototype // true
> froxy.foo === "foo" // true
> ```
>
> #### æ‹¦æˆªæ–¹æ³•
>
> - **get(target, propKey, receiver)**ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è¯»å–ï¼Œæ¯”å¦‚`proxy.foo`å’Œ`proxy['foo']`ã€‚
> - **set(target, propKey, value, receiver)**ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è®¾ç½®ï¼Œæ¯”å¦‚`proxy.foo = v`æˆ–`proxy['foo'] = v`ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚
> - **has(target, propKey)**ï¼šæ‹¦æˆª`propKey in proxy`çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚
> - **deleteProperty(target, propKey)**ï¼šæ‹¦æˆª`delete proxy[propKey]`çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚
> - **ownKeys(target)**ï¼šæ‹¦æˆª`Object.getOwnPropertyNames(proxy)`ã€`Object.getOwnPropertySymbols(proxy)`ã€`Object.keys(proxy)`ã€`for...in`å¾ªç¯ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ–¹æ³•è¿”å›ç›®æ ‡å¯¹è±¡æ‰€æœ‰è‡ªèº«çš„å±æ€§çš„å±æ€§åï¼Œè€Œ`Object.keys()`çš„è¿”å›ç»“æœä»…åŒ…æ‹¬ç›®æ ‡å¯¹è±¡è‡ªèº«çš„å¯éå†å±æ€§ã€‚
> - **getOwnPropertyDescriptor(target, propKey)**ï¼šæ‹¦æˆª`Object.getOwnPropertyDescriptor(proxy, propKey)`ï¼Œè¿”å›å±æ€§çš„æè¿°å¯¹è±¡ã€‚
> - **defineProperty(target, propKey, propDesc)**ï¼šæ‹¦æˆª`Object.defineProperty(proxy, propKey, propDescï¼‰`ã€`Object.defineProperties(proxy, propDescs)`ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚
> - **preventExtensions(target)**ï¼šæ‹¦æˆª`Object.preventExtensions(proxy)`ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚
> - **getPrototypeOf(target)**ï¼šæ‹¦æˆª`Object.getPrototypeOf(proxy)`ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚
> - **isExtensible(target)**ï¼šæ‹¦æˆª`Object.isExtensible(proxy)`ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚
> - **setPrototypeOf(target, proto)**ï¼šæ‹¦æˆª`Object.setPrototypeOf(proxy, proto)`ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚å¦‚æœç›®æ ‡å¯¹è±¡æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆè¿˜æœ‰ä¸¤ç§é¢å¤–æ“ä½œå¯ä»¥æ‹¦æˆªã€‚
> - **apply(target, object, args)**ï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚`proxy(...args)`ã€`proxy.call(object, ...args)`ã€`proxy.apply(...)`ã€‚
> - **construct(target, args)**ï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚`new proxy(...args)`ã€‚

### get()

> - `get(ç›®æ ‡å¯¹è±¡, å±æ€§å, proxyå®ä¾‹æœ¬èº«[å¯é€‰])`æ–¹æ³•ç”¨äºæ‹¦æˆªæŸä¸ªå±æ€§çš„è¯»å–æ“ä½œ
>
> ```js
> const proxy = new Proxy({}, {
>   get: function(target, propKey) {}
> })
> ```
>

## æ‰¿è¯ºå¯¹è±¡ Promise

> ```bash
> ## æ‰¿è¯ºå¯¹è±¡ Promise
> - Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè¡¨ç¤º 'æ‰¿è¯º' æ— æ³•æ”¹å˜ã€‚
> - ä¸€èˆ¬å¤„ç†å¼‚æ­¥äº‹ä»¶æ—¶ï¼Œä½¿ç”¨`Promise`å¯¹è¿™ä¸ªå¼‚æ­¥æ“ä½œè¿›è¡Œå°è£…ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰
>   - å°è£…ä¸€ä¸ªç½‘ç»œè¯·æ±‚å‡½æ•°ï¼Œå› ä¸èƒ½ç«‹å³æ‹¿åˆ°ç»“æœï¼Œæ‰€ä»¥å¾€å¾€ä¼šä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨æ•°æ®è¯·æ±‚æˆåŠŸæ—¶ï¼Œå°†æ•°æ®é€šè¿‡ä¼ å…¥çš„å‡½æ•°å›è°ƒå‡ºå»ï¼ˆç½‘ç»œè¯·æ±‚å¤æ‚ï¼Œä¼šè€—æ—¶è¿‡é•¿ï¼‰
> - newï¼šæ„é€ å‡½æ•°ï¼ˆ1.ä¿å­˜ä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼›2.æ‰§è¡Œä¼ å…¥çš„å‡½æ•°ï¼‰
> 
> 
> 
> ### Promise çš„çŠ¶æ€
> 1. Promise å¯¹è±¡ä»£è¡¨å¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼Œä¸”ä¸å—å¤–ç•Œå½±å“:
> 		- pending: ç­‰å¾…çŠ¶æ€ï¼Œåœ¨ç­‰å“åº”è·³è½¬ã€‚
> 		- resolved/fulfilled: æ»¡è¶³çŠ¶æ€ï¼Œå½“æˆ‘ä»¬ä¸»åŠ¨å›è°ƒresolveæ—¶å¤„äºè¯¥çŠ¶æ€ï¼Œå¹¶ä¸”ä¼šå›è°ƒ`.then()`ã€‚
> 		- rejected: æ‹’ç»çŠ¶æ€ï¼Œå½“æˆ‘ä»¬ä¸»åŠ¨å›è°ƒäº†rejectæ—¶å¤„äºè¯¥çŠ¶æ€ï¼Œå¹¶ä¸”ä¼šå›è°ƒ`.catch()`ã€‚
> 	æ³¨æ„ï¼šåªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚
> 
> 2. ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœ(ä¸å¯é€†)
>   Promise å¯¹è±¡çš„çŠ¶æ€æ”¹å˜åªæœ‰ä¸¤ç§å¯èƒ½ï¼šä» Pending å˜ä¸º Resolved å’Œä» Pending å˜ä¸º Rejectedã€‚
>   åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›º(ä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœï¼Œä¸å†æ”¹å˜)ã€‚
>   å°±ç®—æ”¹å˜å·²ç»å‘ç”Ÿï¼Œå†å¯¹ Promise å¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚
>   è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒçš„æ˜¯å¦‚æœé”™è¿‡äº†è¯¥äº‹ä»¶å†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚
> 
> 
> 
> ### Promise ä¼˜ç¼ºç‚¹
> - ä¼˜ç‚¹ï¼š
> 		- ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä¹‹åçš„ä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°å’Œè¿™ä¸ªç»“æœã€‚
> 		- Promise å¯¹è±¡æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œå¯ä»¥å°†å¼‚æ­¥æ“ä½œä»¥åŒæ­¥æ“ä½œçš„æµç¨‹è¡¨è¾¾å‡ºæ¥ï¼Œé¿å…äº†å±‚å±‚åµŒå¥—çš„å›è°ƒå‡½æ•°(è§£å†³äº†å›è°ƒåœ°ç‹±é—®é¢˜)
>    
> - ç¼ºç‚¹ï¼š
>    - æ— æ³•å–æ¶ˆ Promiseï¼Œä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚
>    - å¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼ŒPromise å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨ã€‚
>    - å½“å¤„äº Pending çŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰
> 
> 
> 
> ### Promise å’Œ setTimeout çš„åŒºåˆ«
> Promise æ˜¯å¾®ä»»åŠ¡ï¼ŒsetTimeout æ˜¯å®ä»»åŠ¡ï¼ŒåŒä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­ï¼Œpromise.thenæ€»æ˜¯å…ˆäº setTimeout æ‰§è¡Œã€‚
> ```

### Promiseåˆ›å»º

- å½“ new Promise()æ‰§è¡Œä¹‹åï¼Œpromise å¯¹è±¡çš„çŠ¶æ€ä¼šè¢«åˆå§‹åŒ–ä¸º`pending`çŠ¶æ€ã€‚`new Promise()`æ‹¬å·é‡Œçš„å†…å®¹æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚æ‹¬å·é‡Œå¯ä»¥å†å®šä¹‰ä¸€ä¸ª å¼‚æ­¥ä»»åŠ¡çš„ function

- Promise æ„é€ å‡½æ•°åŒ…å«ä¸€ä¸ªå‚æ•°å’Œä¸€ä¸ªå¸¦æœ‰ resolveï¼ˆè§£æï¼‰å’Œ rejectï¼ˆæ‹’ç»ï¼‰ä¸¤ä¸ªå‚æ•°çš„å›è°ƒã€‚
  åœ¨å›è°ƒä¸­æ‰§è¡Œä¸€äº›æ“ä½œï¼ˆå¦‚å¼‚æ­¥ï¼‰ï¼Œå¦‚æœä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œåˆ™è°ƒç”¨ resolveï¼Œå¦åˆ™è°ƒç”¨ rejectã€‚

```js
new Promise((resolve, reject) => {
  //åœ¨æ‰§è¡Œä¼ å…¥çš„å›è°ƒå‡½æ•°æ—¶ï¼Œä¼šä¼ å…¥ä¸¤ä¸ªå‚æ•°resolve, rejectï¼Œæœ¬èº«åˆæ˜¯å‡½æ•°
  setTimeout((data) => {
    resolve(data)
  }, 1000)
}).then((data) => {	// ç«‹å³å›è°ƒ
  //æ‰§è¡ŒæˆåŠŸåå¤„ç†çš„ä»£ç  resolveå¤„ç†
  console.log(data);
}).catch(err => {
  //æ•è·æŠ›å‡ºå¼‚å¸¸ rejectå¤„ç†
  console.log(err)
})
```

### é“¾å¼æ“ä½œ then

> ```js
> new Promise((resolve, reject) => {
>   setTimeout(() => {
>     resolve('a')
>   }, 1000)
> }).then(res => {
>   console.log(res)
>   return Promise.resolve(res + '111')
>   // return Promise.reject('error messageï¼ˆè¿”å›å¼‚å¸¸ï¼‰');
>   // throw "error messageï¼ˆæŠ›å‡ºå¼‚å¸¸ï¼‰";
> }).then(res => {
>   console.log(res)
>   return Promise.resolve(res + '222')
> }).then(res => {
>   console.log(res)
> }).catch(err => {
>   console.log(err)
> })
> // è¾“å‡º a a111 a111222
> ```
>
> #### é•¿é“¾å¼è°ƒç”¨
>
> ```js
> new Promise((resolve, reject) => {
>   setTimeout(() => {
>     resolve('Hello World')
>   }, 1000)
> }).then(res => {
>   console.log(res + 'start')
>   return res + '111'
> }).then(res => {
>   console.log(res)
>   return res + '222'
> }).then(res => {
>   console.log(res)
>   return Promise.reject(res + 'error')
> }).then(res => {
>   // æ­¤éƒ¨åˆ†ä¸æ‰§è¡Œï¼Œæ‰€ä»¥ä¸è¾“å‡º
>   console.log(res)
>   return res + '333'
> }).catch(err => {
>   console.log(err)
>   return err + '444'
> }).then(res => {
>   console.log(res + 'end');
> })
> 
> /* Hello Worldstart
> Hello World111
> Hello World111222
> Hello World111222error
> Hello World111222error444end */
> ```

### æœ€ç»ˆæ‰§è¡Œ finally

> ```bash
> ## æœ€ç»ˆæ‰§è¡Œ Promise.prototype.finally()
> - finally() æ–¹æ³•æ— è®º Promise å®ä¾‹æœ€ç»ˆæˆåŠŸè¿˜æ˜¯å¤±è´¥éƒ½ä¼šæ‰§è¡Œã€‚
> - finally() å‡½æ•°ä¸æ¥å—å‚æ•°ï¼Œfinally å†…éƒ¨é€šå¸¸ä¸çŸ¥é“ Promise å®ä¾‹çš„æ‰§è¡Œç»“æœï¼Œæ‰€ä»¥é€šå¸¸åœ¨ finally() æ–¹æ³•å†…æ‰§è¡Œçš„æ˜¯ä¸ Promise çŠ¶æ€æ— å…³çš„æ“ä½œã€‚
> - ä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½ä¼šèµ°åˆ°finallyä¸­,å¹¶ä¸”finallyä¹‹åï¼Œè¿˜å¯ä»¥ç»§ç»­thenã€‚å¹¶ä¸”ä¼šå°†å€¼åŸå°ä¸åŠ¨çš„ä¼ é€’ç»™åé¢çš„thenã€‚
> ```
>
> ```js
> const promise = new Promise((resolve, reject) => {
>   setTimeout(() => {
>     resolve('res')
>   }, 1000)
> })
> promise
>   .then((res) => console.log('success', res))
>   .catch(() => console.log('fail'))
>   .finally(() => console.log('finally'))
> /* è¾“å‡ºï¼š success, res, finally */
> ```
>
> ### `Promise.prototype.finally()` çš„å®ç°
>
> ```js
> Promise.prototype.finally = function (callback) {
>   return this.then((value) => {
>     return Promise.resolve(callback()).then(() => {
>       return value
>     })
>   }, (err) => {
>     return Promise.resolve(callback()).then(() => {
>       throw err
>     })
>   })
> }
> ```

### Promise.all

> ```bash
> ## Promise.all()
> `Promsie.all([p1, p2, p3])`ï¼šå¹¶å‘å¤„ç†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡ŒæˆåŠŸï¼Œæ‰ç®—æˆåŠŸï¼ˆæ‰ä¼šèµ°åˆ° thenï¼‰ï¼›åªè¦æœ‰ä¸€ä¸ªä»»åŠ¡å¤±è´¥ï¼Œå°±ä¼šé©¬ä¸Šèµ°åˆ° catchï¼Œæ•´ä½“éƒ½ç®—å¤±è´¥ã€‚
> - ä¼ é€’çš„å‚æ•°æ˜¯å¤šä¸ª promise å®ä¾‹ç»„æˆçš„æ•°ç»„ã€‚
> ```
>
> ```js
> Promise.all([
>   new Promise((resolve, reject) => {
>     setTimeout(() => {
>       resolve({ name: "willy", age: 11 })
>     }, 2000)
>   }),
>   new Promise((resolve, reject) => {
>     setTimeout(() => {
>       resolve({ name: 'william', age: 22 })
>     }, 3000)
>   })
> ]).then(results => {
>   // console.log(results[0], results[1]);
>   console.log(results); // [{name: 'willy', age: 11}, {name: 'william', age: 22}]
> })
> ```
>
> ### Promise.all() çš„å®ç°
>
> ```bash
> ## Promise.all() çš„å®ç°
> 1. å¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªç©ºçš„å¯è¿­ä»£å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤promiseå¯¹è±¡å›è°ƒå®Œæˆ(resolve)ï¼Œåªæœ‰æ­¤æƒ…å†µï¼Œæ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œå…¶å®ƒéƒ½æ˜¯å¼‚æ­¥è¿”å›çš„ã€‚
> 2. å¦‚æœä¼ å…¥çš„å‚æ•°ä¸åŒ…å«ä»»ä½• promiseï¼Œåˆ™è¿”å›ä¸€ä¸ªå¼‚æ­¥å®Œæˆã€‚ promises ä¸­æ‰€æœ‰çš„promiseéƒ½â€œå®Œæˆâ€æ—¶æˆ–å‚æ•°ä¸­ä¸åŒ…å« promise æ—¶å›è°ƒå®Œæˆã€‚
> 3. å¦‚æœå‚æ•°ä¸­æœ‰ä¸€ä¸ªpromiseå¤±è´¥ï¼Œé‚£ä¹ˆPromise.allè¿”å›çš„promiseå¯¹è±¡å¤±è´¥ã€‚
> 4. åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼ŒPromise.all è¿”å›çš„ promise çš„å®ŒæˆçŠ¶æ€çš„ç»“æœéƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚
> ```
>
> ```js
> Promise.all = function (promises) {
>   return new Promise((resolve, reject) => {
>     let index = 0;
>     let result = [];
>     if (promises.length === 0) {
>       resolve(result);
>     } else {
>       function processValue(i, data) {
>         result[i] = data;
>         if (++index === promises.length) {
>           resolve(result);
>         }
>       }
>       for (let i = 0; i < promises.length; i++) {
>         // promises[i] å¯èƒ½æ˜¯æ™®é€šå€¼
>         Promise.resolve(promises[i]).then((data) => {
>           processValue(i, data);
>         }, (err) => {
>           reject(err);
>           return;
>         });
>       }
>     }
>   });
> }
> ```

### Promise.race

- `Promise.race([p1, p2, p3])`ï¼šå¹¶å‘å¤„ç†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œ**è¿”å›çš„æ˜¯ç¬¬ä¸€ä¸ªæ‰§è¡Œå®Œæˆçš„ promise**ï¼Œä¸”çŠ¶æ€å’Œç¬¬ä¸€ä¸ªå®Œæˆçš„ä»»åŠ¡çŠ¶æ€ä¿æŒä¸€è‡´ã€‚å‚æ•°é‡Œä¼ çš„æ˜¯å¤šä¸ª promise å®ä¾‹ç»„æˆçš„æ•°ç»„ã€‚
- åªè¦æœ‰ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ•´ä½“å°±æ˜¯å®Œæˆçš„
- é€šå¸¸åœ¨httpè¯·æ±‚æ—¶ï¼Œåšè¶…æ—¶åˆ¤æ–­æ—¶å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå½“å®šæ—¶å™¨æ—¶é—´åˆ°äº†æ—¶å°±åœ¨UIä¸Šæé†’è¯·æ±‚è¶…æ—¶

```js
const promise1 = new Promise((resolve, reject) => { setTimeout(resolve, 500, 'promise 1 resolved') })
const promise2 = new Promise((resolve, reject) => { setTimeout(reject, 100, 'promise 2 rejected') })
const promise3 = new Promise((resolve, reject) => { setTimeout(resolve, 200, 'promise 3 resolved') })
(async () => {
  try {
    const result = await Promise.race([promise1, promise2, promise3]);
    console.log(result);
  } catch (err) {
    console.error(err);
  }
})()
// è¾“å‡º- "promise 2 rejected"   
// å°½ç®¡promise1å’Œpromise3å¯ä»¥è§£å†³ï¼Œä½†promise2æ‹’ç»çš„é€Ÿåº¦æ¯”å®ƒä»¬å¿«ã€‚   
// å› æ­¤Promise.raceæ–¹æ³•å°†ä»¥promise2æ‹’ç»
```

```js
Promise.all([]).then((res) => {
  console.log('all');
});
Promise.race([]).then((res) => {
  console.log('race');
});
/*  allä¼šè¾“å‡ºï¼Œraceä¸ä¼šè¾“å‡º */
```

### Promise.any å’Œ AggregateError

> ```bash
> ## Promise.any() ä¸ AggregateError
> - Promise.any() æ¥æ”¶ä¸€ä¸ª Promise å¯è¿­ä»£å¯¹è±¡(å¦‚æ•°ç»„)ï¼Œåªè¦å…¶ä¸­ä¸€ä¸ª Promise æˆåŠŸï¼Œå°±è¿”å›é‚£ä¸ªå·²ç»æˆåŠŸçš„ Promise
> 
> - å¦‚æœä¼ å…¥çš„å¯è¿­ä»£å¯¹è±¡ä¸­çš„æ‰€æœ‰ Promise éƒ½å¤±è´¥ï¼Œå°†è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ‹’ç»å€¼çš„ `AggregateError` å®ä¾‹ã€‚å®ƒæ˜¯ Error çš„ä¸€ä¸ªå­ç±»ï¼Œç”¨äºæŠŠå•ä¸€çš„é”™è¯¯é›†åˆåœ¨ä¸€èµ·ã€‚
> 
> - åªè¦ä¸€ä¸ªæˆåŠŸå°±è¿”å›æˆåŠŸï¼Œå¦‚æœæ‰€æœ‰çš„éƒ½å¤±è´¥æ‰ä¼šæŠ¥é”™ï¼›
> - å¦‚æœ Promise.any æ¥æ”¶çš„æ˜¯ä¸€ä¸ªé promise æ•°ç»„ï¼Œåˆ™è¿”å›æˆåŠŸã€‚
> ```
>
> ````js
> const promise1 = new Promise((resolve, reject) => { setTimeout(reject, 100, 'promise 1 rejected') })
> const promise2 = new Promise((resolve, reject) => { setTimeout(resolve, 400, 'promise 2 resolved at 400 ms') })
> const promise3 = new Promise((resolve, reject) => { setTimeout(resolve, 700, 'promise 3 resolved at 800 ms') })
> (async () => {
>   try {
>     const value = await Promise.any([promise1, promise2, promise3])
>     console.log(value)
>   } catch (error) {
>     console.log(error)
>   }
> })()
> //Output - "promise 2 resolved at 400 ms" 
> ````
>
> ```js
> // ç¤ºä¾‹ä¼ªä»£ç 
> /* è¿”å›æˆåŠŸçš„ */
> const promises1 = [
>   Promise.reject('ERROR A'),
>   Promise.reject('ERROR B'),
>   Promise.resolve('result'),
> ]
> 
> Promise.any(promises1).then((value) => {
>   console.log('value: ', value)
> }).catch((err) => {
>   console.log('err: ', err)
> })
> // è¾“å‡ºç»“æœï¼švalue:  result
> 
> /* ä¼ å…¥çš„æ‰€æœ‰Promiseséƒ½å¤±è´¥ */
> const promises2 = [
>   Promise.reject('ERROR A'),
>   Promise.reject('ERROR B'),
>   Promise.reject('ERROR C'),
> ]
> Promise.any(promises2).then((value) => {
>   console.log('valueï¼š', value)
> }).catch((err) => {
>   console.log('errï¼š', err)
>   console.log(err.message)
>   console.log(err.name)
>   console.log(err.errors)
> })
> /* errï¼šAggregateError: All promises were rejected
> All promises were rejected
> AggregateError
> ["ERROR A", "ERROR B", "ERROR C"] */
> ```
>

### Promise.allã€raceã€anyçš„åŒºåˆ«

- Promise.any();æœ‰ä¸€ä¸ªå­å®ä¾‹æˆåŠŸå°±ç®—æˆåŠŸï¼Œå…¨éƒ¨å­å®ä¾‹å¤±è´¥æ‰ç®—å¤±è´¥ï¼›
- Promise.all()ï¼›å…¨éƒ¨å­å®ä¾‹çš„æˆåŠŸæ‰ç®—æˆåŠŸï¼Œä¸€ä¸ªå­å®ä¾‹å¤±è´¥å°±ç®—å¤±è´¥ï¼›
- Promise.race()ï¼›receæ˜¯èµ›è·‘æœºåˆ¶ï¼Œçœ‹æœ€å…ˆçš„promiseå­å®ä¾‹æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚

### Promise.allSettled

> - å½“æ‰€æœ‰ç»™å®šçš„ Promise éƒ½å¾—åˆ°è§£å†³æ—¶è¿”å›ï¼ˆ`resolved` æˆ– `rejected`ï¼Œæ— å…³ç´§è¦ï¼‰ã€‚
>
> ```js
> const sleep = (sm) => new Promise((resolve) => setTimeout(() => resolve(sm), sm))
> const err = (ms) => sleep(ms).then(() => Promise.reject(ms))
> 
> Promise.allSettled([1, 2, 3]).then(console.log)
> Promise.allSettled([sleep(300), sleep(100), sleep(200)]).then(console.log)
> Promise.allSettled([sleep(3000), err(100), sleep(2000)]).then(console.log)
> Promise.allSettled([err(50), err(60)]).then(console.log)
> ```

### Promiseå°è£…Ajax

> ```js
> function ajax(URL) {
>   return new Promise(function (resolve, reject) {
>     const req = new XMLHttpRequest();
>     req.open('GET', URL, true);
>     req.send();
>     req.onload = function () {
>       if (req.status === 200) {
>         resolve(req.responseText);
>       } else {
>         reject(new Error(req.statusText));
>       }
>     };
>     
>     req.onerror = function () {
>       reject(new Error(req.statusText));
>     };
>   });
> }
> 
> // è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ª Promiseå¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦ç”¨then/catch
> ajax("./test.php")
>   .then(function onFulfilled(value) {
>     document.write('å†…å®¹æ˜¯ï¼š' + value);
>   }).catch(function onRejected(error) {
>     document.write('é”™è¯¯ï¼š' + error);
>   });
> ```

### å›è°ƒå‡½æ•°çš„ç¼ºç‚¹

> - å›è°ƒçš„å†™æ³•æ¯”è¾ƒç›´è§‚ï¼Œä¸éœ€è¦ returnï¼Œå±‚å±‚åµŒå¥—å³å¯
> - å¦‚æœå¤šä¸ªå¼‚æ­¥å‡½æ•°å­˜åœ¨ä¾èµ–å…³ç³»ï¼ˆéœ€è¦ç­‰å‰ä¸€ä¸ªå¼‚æ­¥å‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼‰ï¼Œå°±éœ€è¦å¤šä¸ªå¼‚æ­¥å‡½æ•°è¿›â¾å±‚å±‚åµŒå¥—ï¼Œä¼šå¯¼è‡´**å›è°ƒåœ°ç‹±**çš„é—®é¢˜ã€‚
>
> #### å®šæ—¶å™¨çš„å›è°ƒåœ°ç‹±
>
> ```js
> setTimeout(function () {
>     console.log('qiangu1');
>     setTimeout(function () {
>         console.log('qiangu2');
>         setTimeout(function () {
>             console.log('qiangu3');
>         }, 3000);
>     }, 2000);
> }, 1000);
> ```
>
> #### ajax è¯·æ±‚çš„å›è°ƒåœ°ç‹±
>
> ```javascript
> // ä¼ªä»£ç 
> ajax('a.json', (res1) => {
>     console.log(res1);
>     ajax('b.json', (res2) => {
>         console.log(res2);
>         ajax('c.json', (res3) => {
>             console.log(res3);
>         });
>     });
> });
> ```
>
> #### å›è°ƒçš„å†™æ³•ä¸ä¸€è‡´é—®é¢˜
>
> ```javascript
> // Node.js è¯»å–æ–‡ä»¶æ—¶ï¼ŒæˆåŠŸå›è°ƒå’Œå¤±è´¥å›è°ƒï¼Œæ˜¯é€šè¿‡ errorå‚æ•°æ¥åŒºåˆ†
> readFile('d:\\readme.text', function (error, data) {
>   if (error) {
>     console.log('æ–‡ä»¶è¯»å–å¤±è´¥');
>   } else {
>     console.log('æ–‡ä»¶è¯»å–æˆåŠŸ');
>   }
> });
> 
> // jQueryçš„ ajax å†™æ³•ä¸­ï¼ŒæˆåŠŸå›è°ƒå’Œå¤±è´¥å›è°ƒï¼Œæ˜¯é€šè¿‡ä¸¤ä¸ªå›è°ƒå‡½æ•°æ¥åŒºåˆ†
> $.ajax({
>   url: '/ajax.json',
>   success: function (response) {
>     console.log('æ–‡ä»¶è¯»å–æˆåŠŸ');
>   },
>   error: function (err) {
>     console.log('æ–‡ä»¶è¯»å–å¤±è´¥');
>   },
> });
> ```
>

### æ•è·å¼‚å¸¸ `try/catch`

> ```bash
> ## æ•è·å¼‚å¸¸ try...catch
> - try-catch ä¸»è¦ç”¨äºæ•è· 'åŒæ­¥å‡½æ•°' çš„å¼‚å¸¸ï¼Œæ— æ³•æ•è·å¼‚æ­¥å‡½æ•°çš„å¼‚å¸¸
> åŸå› æ˜¯å½“å¼‚æ­¥å‡½æ•°æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œ
>     - å¯¹äºå®ä»»åŠ¡è€Œè¨€ï¼Œæ‰§è¡Œå‡½æ•°æ—¶å·²ç»å°†è¯¥å‡½æ•°æ¨å…¥æ ˆï¼Œæ­¤æ—¶å¹¶ä¸åœ¨ try-catch æ‰€åœ¨çš„æ ˆï¼Œæ‰€ä»¥ try-catch å¹¶ä¸èƒ½æ•è·åˆ°é”™è¯¯ã€‚
>     - å¯¹äºå¾®ä»»åŠ¡è€Œè¨€ï¼ˆå¦‚ Promise çš„æ„é€ å‡½æ•°çš„å¼‚å¸¸åªèƒ½è¢«è‡ªå¸¦çš„ rejectï¼ˆ.catchå‡½æ•°ï¼‰æ•è·åˆ°ï¼‰
> 
> 
> 
> ### `promiseA().then().catch()` å’Œ `promiseA.catch().then()` çš„åŒºåˆ«
> 		- å‰è€…å¯ä»¥æ•è·åˆ° `then` é‡Œé¢çš„å¼‚å¸¸ï¼›
> 		- åè€…ä¸èƒ½æ•è·åˆ° `then` é‡Œé¢çš„å¼‚å¸¸ã€‚
> 
> 
> 
> ### å¯é€‰ catch ç»‘å®š
> åœ¨ ES10 ä¹‹å‰ï¼Œè¯­æ³•è¿«ä½¿æˆ‘ä»¬ä¸º `catch` å­å¥ç»‘å®šä¸€ä¸ªå¼‚å¸¸å˜é‡ï¼Œä¸ç®¡å®ƒæ˜¯å¦å¿…è¦ã€‚
> å¾ˆå¤šæ—¶å€™å¯ä»¥æ³¨æ„åˆ°ï¼Œ`catch` å—åªæ˜¯å¤šä½™çš„ã€‚ES10 ææ¡ˆä½¿æˆ‘ä»¬èƒ½å¤Ÿå®Œå…¨å¿½ç•¥å˜é‡ï¼Œè®©æˆ‘ä»¬å°‘å…³å¿ƒä¸€ä»¶äº‹ã€‚
>         try {
>           const data = JSON.parse(obj)
>           return true
>         } catch {
>           return false
>         }
> ```

### å¼‚æ­¥å‡½æ•° async/await

> ```bash
> ## å¼‚æ­¥å‡½æ•° async/await
> - `async/await` æ˜¯ Generator çš„è¯­æ³•ç³–ï¼Œæ˜¯ä¸€ä¸ªè‡ªæ‰§è¡Œçš„ generate å‡½æ•°ã€‚
> 		`async function` ä»£æ›¿äº† `function *`ï¼Œ`await` ä»£æ›¿äº† `yield`ï¼ŒåŒæ—¶ä¹Ÿæ— éœ€è‡ªå·±æ‰‹å†™ä¸€ä¸ªè‡ªåŠ¨æ‰§è¡Œå™¨ runã€‚
> 
> 
> 
> ```
>
> ```js
> /** Generator */
> run(function* () {
>   const res1 = yield readFile(path.resolve(__dirname, './test.css'), { encoding: 'utf8' });
>   console.log(res1);
>   const res2 = yield readFile(path.resolve(__dirname, './json.js'), { encoding: 'utf8' });
>   console.log(res2);
> })();
> 
> 
> /** async...await */
> const readFile = async () => {
>   const res1 = await readFile(path.resolve(__dirname, './test.css'), { encoding: 'utf8' });
>   console.log(res1);
>   const res2 = await readFile(path.resolve(__dirname, './json.js'), { encoding: 'utf8' });
>   console.log(res2);
>   return 'done';
> }
> const res = readFile();
> ```

- `async`ç”¨äºç”³æ˜ä¸€ä¸ª`function`æ˜¯å¼‚æ­¥çš„ï¼Œè€Œ`await`ç”¨äºç­‰å¾…ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæˆï¼ˆ`await`åªå‡ºç°åœ¨`async`å‡½æ•°ä¸­ï¼‰

- **async å‡½æ•°ä¼šå§‹ç»ˆè¿”å›ä¸€ä¸ª Promise å¯¹è±¡**ã€‚async å‡½æ•°ä¼šæŠŠè¿”å›å€¼é€šè¿‡ Promise.resolve() å°è£…æˆ Promise å¯¹è±¡å†è¿”å›ã€‚

- åœ¨å‡½æ•°å†…éƒ¨æ²¡æœ‰ `await` å…³é”®å­—çš„æƒ…å†µä¸‹æ‰§è¡Œ async å‡½æ•°ï¼Œå‡½æ•°ä¼šç«‹å³æ‰§è¡Œï¼Œä½†ä»ç„¶è¿”å›ä¸€ä¸ªå·²è§£å†³çš„ Promiseï¼Œä¸”ç»ä¸ä¼šé˜»å¡åé¢çš„è¯­å¥ã€‚è¿™æ„å‘³ç€å³ä½¿æ²¡æœ‰ `await` å…³é”®å­—ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨ `.then` å’Œ `.catch` æ¥å¤„ç†è¯¥å‡½æ•°äº§ç”Ÿçš„ Promiseã€‚

  ```js
  async function Async() {
      return "hello,async"
  }
  Async().then(result => {
      console.log(result);	// hello,async
  })
  ```

- `await`æ˜¯è¿ç®—ç¬¦ï¼Œawait è¡¨è¾¾å¼çš„è¿ç®—ç»“æœå–å†³äºå®ƒç­‰çš„ä¸œè¥¿ã€‚å¦‚æœå®ƒç­‰åˆ°çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œç­‰ Promise å¯¹è±¡ resolveï¼Œç„¶åå¾—åˆ° resolve çš„å€¼ï¼Œä½œä¸º await è¡¨è¾¾å¼çš„è¿ç®—ç»“æœã€‚async å‡½æ•°è°ƒç”¨ä¸ä¼šé€ æˆé˜»å¡ï¼Œå®ƒå†…éƒ¨æ‰€æœ‰çš„é˜»å¡éƒ½è¢«å°è£…åœ¨ä¸€ä¸ª Promise å¯¹è±¡ä¸­å¼‚æ­¥æ‰§è¡Œã€‚

- å•ä¸€çš„ Promise é“¾å¹¶ä¸èƒ½å‘ç° async/await çš„ä¼˜åŠ¿ï¼Œä½†å¦‚æœéœ€è¦å¤„ç†ç”±å¤šä¸ª Promise ç»„æˆçš„ then é“¾æ—¶ï¼Œä¼˜åŠ¿å°±èƒ½ä½“ç°å‡ºæ¥ï¼ˆPromise é€šè¿‡ then é“¾æ¥è§£å†³å¤šå±‚å›è°ƒçš„é—®é¢˜ï¼Œåˆç”¨ async/await æ¥è¿›ä¸€æ­¥ä¼˜åŒ–å®ƒ)

- **ä¾‹ï¼šå‡è®¾ä¸€ä¸ªä¸šåŠ¡ï¼Œåˆ†å¤šä¸ªæ­¥éª¤å®Œæˆï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œè€Œä¸”ä¾èµ–äºä¸Šä¸€ä¸ªæ­¥éª¤çš„ç»“æœ**

```js
console.log("å‡è®¾ä¸€ä¸ªä¸šåŠ¡ï¼Œåˆ†å¤šä¸ªæ­¥éª¤å®Œæˆï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œè€Œä¸”ä¾èµ–äºä¸Šä¸€ä¸ªæ­¥éª¤çš„ç»“æœ");
function takeLongTime(n) {
    return new Promise(resolve => {
        setTimeout(() => resolve(n + 200), n);
    });
}
step1 = (n) => {
    console.log(`step1 with ${n}`);
    return takeLongTime(n);
}
step2 = (m, n) => {
    console.log(`step2 with ${m} and ${n}`);
    return takeLongTime(m, n);
}
step3 = (k, m, n) => {
    console.log(`step3 with ${k}, ${m} and ${n}`);
    return takeLongTime(k + m + n);
}

/* doIt = () => {
    console.time("Pormise .then()");
    const time1 = 300;
    step1(time1)
        .then(time2 => {
            return step2(time1, time2)
                .then(time3 => [time1, time2, time3]);
        })
        .then(times => {
            const [time1, time2, time3] = times;
            return step3(time1, time2, time3);
        })
        .then(result => {
            console.log(`Pormise .then() result is ${result}`);
            console.timeEnd('Pormise .then()');
        })
    
}
doIt(); */
/* è¾“å‡º doIt()
step1 with 300
step2 with 300 and 500
step3 with 300, 500 and 500
Pormise .then() result is 1500
Pormise .then(): 1909.204ms */

async function test() {
    console.time("async && await");
    const time1 = 300;
    const time2 = await step1(time1);
    const time3 = await step2(time1, time2);
    const result = await step3(time1, time2, time3);
    console.log(`async && await result is ${result}`);
    console.timeEnd(`async && await`);
}
test();

/* è¾“å‡º test()
step1 with 300
step2 with 300 and 500
step3 with 300, 500 and 500
async && await result is 1500
async && await: 1910.646ms */
```

####  async/await ä¸ try/catch ç»“åˆä½¿ç”¨

```js
// vue ä¸­ä½¿ç”¨ async/await ä¸ try/catch ç»“åˆä½¿ç”¨
async reqHttp = () => {
  try {
    let params = {};
  	const res = await this.$http.reqInterface(params);
    let { code, total, rows, info } = res.data;
    if(code == 1) {
      this.rowData = rows;
      this.total = total;
    } else {
      console.log("è·å–æ•°æ®å¼‚å¸¸", info)
    }
  } catch(err) {
    this.$message.error("è¯·æ±‚æ¥å£å¼‚å¸¸",error);
  }
}
```

#### å¼‚æ­¥è¿­ä»£å™¨`for await...of`

> ```bash
> ## å¼‚æ­¥è¿­ä»£å™¨ for-await...of
> -  ES2018 å¼•å…¥å¼‚æ­¥è¿­ä»£å™¨ï¼ˆasynchronous iteratorsï¼‰ï¼Œè¿™å°±åƒå¸¸è§„è¿­ä»£å™¨ï¼Œé™¤äº†`next()` æ–¹æ³•è¿”å›ä¸€ä¸ª Promiseã€‚å› æ­¤ `await` å¯ä»¥å’Œ `for...of` å¾ªç¯ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ä¸²è¡Œçš„æ–¹å¼è¿è¡Œå¼‚æ­¥æ“ä½œã€‚
> 
> - for-await...of ä¸»è¦ç”¨äºéå†å¼‚æ­¥å¯è¿­ä»£å¯¹è±¡ã€‚å…¶ä¼šåœ¨å¼‚æ­¥æˆ–åŒæ­¥å¯è¿­ä»£å¯¹è±¡ä¸­åˆ›å»ºä¸€ä¸ªè¿­ä»£å¾ªç¯ï¼ˆString/Array/ç±»æ•°ç»„/Map/Set/è‡ªå®šä¹‰å¯è¿­ä»£å¯¹è±¡ï¼‰
> 
> - æ³¨æ„1ï¼šfor-await...of è¯­å¥åªèƒ½åœ¨ async function å†…ä½¿ç”¨ã€‚
> - æ³¨æ„2ï¼šå¦‚æœæ˜¯å¯»å¸¸çš„åŒæ­¥éå†æ–¹æ³•è¿›è¡Œå¾ªç¯ï¼Œå…¶æ‰§è¡Œé¡ºåºä¸ä¼šæŒ‰é¡ºåºæ‰§è¡Œã€‚
> ```
>
> ```js
> function Gen(time) {
>   return new Promise((resolve, reject) => {
>     setTimeout(function () {
>       resolve(time)
>     }, time)
>   })
> }
> 
> /** æ­£ç¡®ä»£ç ç¤ºä¾‹ */
> async function test1() {
>   const arr = [Gen(2000), Gen(100), Gen(3000)]
>   for await (let item of arr) {
>     console.log(item)
>   }
> }
> test1()	// è¾“å‡ºï¼š2000, 100, 3000
> 
> 
> /** æ­£ç¡®ä»£ç ç¤ºä¾‹ï¼šfor-await...of çš„å®ç°åŸç† */
> async function test2() {
>   const arr = [Gen(2000), Gen(100), Gen(3000)]
>   for (let i of arr) {
>   	const res = await i
>     console.log(res)
>   } 
> }
> test2()	// è¾“å‡ºï¼š100, 2000, 3000
> 
> /** é”™è¯¯ä»£ç ç¤ºä¾‹ï¼šä¸ä¼šæœ‰æ•ˆæ‰§è¡Œçš„å¾ªç¯ï¼ˆä¸ä¼šæŒ‰é¡ºåºæ‰§è¡Œï¼‰ */
> async function test3() {
>   const arr = [Gen(2000), Gen(100), Gen(3000)]
>   arr.forEach(async (i) => {
>     const res = await i
>     console.log(res)
>   })
> }
> test3()	// è¾“å‡ºï¼š100, 2000, 3000
> ```
>

